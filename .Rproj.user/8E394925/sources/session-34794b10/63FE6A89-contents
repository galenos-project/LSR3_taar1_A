---
title: "LSR3 analysis: effects of TAAR1 agonists in animal models of psychosis"
author: "Francesca Tinsdeall, Fiona Ramage, Virginia Chiocchia and Malcolm Macleod"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  html_document: 
    toc: true
    df_print: paged
    fig_width: 9
bibliography: grateful-refs.bib
editor_options: 
  chunk_output_type: console
---

```{r setup, message=F, echo=F, include=F}
### libraries
library(ggplot2)
library(devtools)
library(dosresmeta)
library(dplyr)
library(grid)
library(gtools)
library(kableExtra)
library(graphics)
library(patchwork)
library(forcats)
library(knitr)
library(ggplot2)
library(Matrix)
library(meta)
library(metafor)
library(orchaRd)
library(readxl)
library(readr)
library(rje)
library(rms)
library(stringr)
library(tibble)
library(tidyr)
library(tools)
library(rlang)
#devtools::install_github("mcguinlu/robvis")
#install_github("mcguinlu/robvis")
library(robvis)
library(PRISMA2020)
library(grateful)
library(xtable)



#define LSR
LSR <- 'LSR3'
# define date of processing
DoP <- Sys.Date()


# All function needed to run this notebook (analyses, etc.) should be in a util.R file
source("util/util.R")

# obtain the data and prepare them for analysis - all data cleaning routines should be in this .R script 


source("wrangling/wrangling_functions.R", local = TRUE)
source("wrangling/data_wrangle_script.R")

#Round off results to two digits
options(scipen=100, digits=3)

# Import data
file2load <- paste0(LSR,'_clean_data_',DoP,'.csv')
df <- read_csv(file2load)

```

# 1. Flow of study selection and descriptives

```{r article metadata, eval = TRUE, echo = FALSE}
# Retrieve article metadata omitted from 'clean_data.csv' and join 

article_metadata <- df %>% 
  select(StudyId, Title, Year) %>%
  distinct()
```

The flow of study selection is shown in Figure 1. Studies included were published between `r min(article_metadata$Year)` and `r max(article_metadata$Year)`. Overall, this analysis includes `r length(table(df$StudyId))` studies containing `r nrow(df)` comparisons.

**Figure 1 - PRISMA flowchart**

```{r PRISMA flowchart, eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE}
prisma_data <- read_csv("data/LSR3_prisma_211223.csv")
dfp <- PRISMA_data(prisma_data)
PRISMA_flowdiagram(dfp, interactive=FALSE, previous=FALSE, other=FALSE,
                    detail_databases=FALSE, detail_registers=FALSE, fontsize=12, font="Helvetica",
                    title_colour="Goldenrod1", greybox_colour="Gainsboro", main_colour="Black",
                    arrow_colour="Black", arrow_head="normal", arrow_tail="none", side_boxes=TRUE )

```

The table below gives a summary of the included studies, the model and species used, the intervention tested, and the outcome measured. N represents an aggregate of animals contributing to outcomes reported from control and treatment groups, and if the same control group has contributed to more than one experiment, it will be counted twice.

```{r results="asis", echo = FALSE, warning=FALSE, message=FALSE}

tab2 <- read_csv("data/tab2.csv")
tab2$N <- as.numeric(tab2$N)
original_data <- tab2[1:45, 1:6]

# Rows to have bold lines beneath
rows_with_bold_lines <- c(2, 3, 7, 8, 9, 11, 12, 13, 19, 23, 26, 27, 36, 38)

# Generate HTML table with adjusted styles
cat('<div style="text-align: center;">')
cat('<table style="width: 100%; border-collapse: collapse;">')

# Table header
cat('<tr style="border-bottom: 2px solid black;">')
for (col_name in names(original_data)) {
  cat(paste('<th style="padding: 8px; text-align: center;">', col_name, '</th>', sep = ''))
}
cat('</tr>')

# Table rows
for (i in seq_len(nrow(original_data))) {
  cat('<tr>')
  for (j in seq_len(ncol(original_data))) {
    cell_content <- original_data[i, j]
    cell_style <- ifelse(i %in% rows_with_bold_lines, 'border-bottom: 2px solid black; padding: 8px; text-align: center;', 'border-bottom: 1px solid black; padding: 8px; text-align: center;')
    if (j == 1) {
      cell_style <- gsub('text-align: center;', 'text-align: left;', cell_style)
    }
    cat(paste('<td style="', cell_style, '">', cell_content, '</td>', sep = ''))
  }
  cat('</tr>')
}

# Bottom border for the last row
cat('<tr style="border-top: 1px solid black;">')
for (j in seq_len(ncol(original_data))) {
  cell_content <- original_data[nrow(original_data), j]
  cell_style <- ifelse(nrow(original_data) %in% rows_with_bold_lines, 'border-bottom: 2px solid black; padding: 8px; text-align: center;', 'border-bottom: 2px solid black; padding: 8px; text-align: center;')
  if (j == 1) {
    cell_style <- gsub('text-align: center;', 'text-align: left;', cell_style)
  }
  cat(paste('<td style="', cell_style, '">', cell_content, '</td>', sep = ''))
}
cat('</tr>')

cat('</table>')
cat('</div>')


```

References of included studies are located in the appendix. Included studies used `r length(table(df$ModelID))` unique disease model induction procedures.

## 1.1 Description of experiment types and methodological approach

Within the literature we identified distinct categories of experiments and the data presented would allow several meta-analytical contrasts to be drawn:

1.  **TAAR1 agonist vs control**. These were experiments investigating the effect of administering a TAAR1 agonist alone, reported in `r nrow(df %>% filter(SortLabel == "TvC"))` experiments from `r nrow(df %>% filter(SortLabel == "TvC") %>% distinct(StudyId))` publications.

2.  **TAAR1 agonist vs 'known' antipsychotic drug**. These were experiments investigating the effect of administering a TAAR1 agonist alongside a currently licensed anti-psychotic reported in `r nrow(df %>% filter(SortLabel == "TvA"))` experiments from `r nrow(df %>% filter(SortLabel == "TvA") %>% distinct(StudyId))` publications.

3.  **Co-treatment with TAAR1 agonist plus know antipsychotic drug v known antipsychotic drug alone**, reported in `r nrow(df %>% filter(SortLabel == "TAvA"))` experiments from `r nrow(df %>% filter(SortLabel == "TAvA") %>% distinct(StudyId))` publications.

4.  **Effect of TAAR1 antagonism on the effect of TAAR1 agonist v control.** These were experiments investigating whether any effect of TAAR1 agonism was inhibited by TAAR1 antagonism. In this iteration of the review, all experiments within this category used genetic approaches to TAAR1 antogonism (that is, they knocked out the gene for the TAAR1 receptor, so any observed drug effect could not be due to actions mediated through the TAAR1 receptor, and therefore could not be considered specific drug effects mediated through the TAAR1 receptor.

Each experiment type is analysed separately. This is because each experiment type uses different control conditions.

In these studies the:

-   **Control group** is a group of animals that is (1) subjected to a psychosis model induction paradigm and (2) administered a control treatment (vehicle) or no treatment

-   **Intervention group** is a group of animals that is (1) subjected to a psychosis model induction paradigm and (2) administered a TAAR1 agonist treatment

-   **Sham group** is a group of animals that is (1) not subjected to a psychosis model induction paradigm and (2) administered a control treatment (vehicle) or no treatment. These data are required to allow a 'normalised mean difference' (NMD) effect size to be calculated, given by

    $$
    \frac{(\text{$\bar{\mu}_C - \bar{\mu}_T$})}
    {(\text{$\bar{\mu}_C - \bar{\mu}_S$)}} \text{   x   100}
    $$

where $\bar{\mu}_C$, $\bar{\mu}_T$, $\bar{\mu}_S$ are the mean reported scores in the control, treatment, and sham groups respectively.

Outcomes with ≥2 independent effect sizes were considered for meta-analysis. In this iteration of the review, this includes `r df %>% group_by(outcome_type) %>% filter(n_distinct(StudyId) > 1) %>% summarise(n = n_distinct(StudyId)) %>% arrange(desc(n)) %>% pull(outcome_type) %>% unique() %>% tolower() %>% { if (length(.) > 1) paste(paste(head(., -1), collapse = ", "), "and", tail(., 1)) else .}`.

All analyses were conducted allowing for the following hierarchical levels in a random effects model, which accounts for features common to experimental contrasts such as a shared control group:

-   **Level 1: Rodent strain** - effect sizes measured across experiments using the same rodent strain

-   **Level 2: Study** - effect sizes measured from different experiments presented in the same publication

-   **Level 3: Experiment** - effect sizes measured in the same experiment within a study, where often a control group contributes to several effect sizes

The hierarchical grouping may therefore be considered thus: **Strains** of laboratory animals are included in several **Studies**, each of which can report one or more **Experiments**, and each Experiment is comprised of at least two **Cohorts** which are considered identical except for differing in the experimental manipulation (the **Intervention**) or not being exposed to the disease modelling procedures (a **Sham** cohort, these only being used to provide a baseline for outcome measures to allow Normalised Mean Difference meta-analysis). An **Experiment** can include several **experimental contrasts**, for instance where different doses of drugs are compared to the same control group.

For some experimental contrasts, more than one locomotor or cognitive outcome - for instance both horizontal and vertical climbing activity - was measured in the same cohort of animals. Further, some publications used the same drug doses with the same outcome measures in different experiments. For these reasons, some of the forest plots may appear to include 'duplicate' Study - Drug - Dose combinations with different outcomes. For the former there were insufficient levels of the different locomotor or cognitive outcome measures to allow for hierachical analysis and so this was not performed; and for the later, these are accounted for in the heirarchical analysis.

# 2 TAAR1 Agonists v Control

```{r # Split df by experiment and outcome type into dataframes to simply inline code below - TAAR1 Agonist v Control, eval = TRUE, echo = FALSE}
df_S <- filter(df, SortLabel == "TvC")
df_S_LMA <- filter_experiment_outcome_type(df, "TvC", "Locomotor activity")
df_S_PPI <- filter_experiment_outcome_type(df, "TvC", "Prepulse inhibition")
df_S_cog <- filter_experiment_outcome_type(df, "TvC", "Cognition")
df_S_social <- filter_experiment_outcome_type(df, "TvC", "Social interaction")
df_S_stereo <- filter_experiment_outcome_type(df, "TvC", "Stereotypy")
```

`r length(table(df_S$StudyId))` studies (`r nrow(df%>%filter(SortLabel == "TvC"))` comparisons) investigated the effects of TAAR1 Agonist versus Control. The number of studies and individual effect sizes for each outcome were:

-   Locomotor activity\*: `r length(table(df_S_LMA$StudyId))` studies and `r nrow(df_S_LMA)` comparisons in `r {strains <- unique(df_S_LMA$Strain); if (length(strains) > 1) paste(length(strains), "strains") else paste(length(strains), "strain")}`

-   Prepulse inhibition\*: `r length(table(df_S_PPI$StudyId))` studies and `r nrow(df_S_PPI)` comparisons in `r {strains <- unique(df_S_PPI$Strain); if (length(strains) > 1) paste(length(strains), "strains") else paste(length(strains), "strain")}`

-   Cognitive function: `r length(table(df_S_cog$StudyId))` studies and `r nrow(df_S_cog)` comparisons in `r {strains <- unique(df_S_cog$Strain); if (length(strains) > 1) paste(length(strains), "strains") else paste(length(strains), "strain")}`

-   Social interaction: `r length(table(df_S_social$StudyId))` studies and `r nrow(df_S_social)` comparisons in `r {strains <- unique(df_S_social$Strain); if (length(strains) > 1) paste(length(strains), "strains") else paste(length(strains), "strain")}`

-   Stereotypy: `r length(table(df_S_stereo$StudyId))` studies and `r nrow(df_S_stereo)` comparisons in `r {strains <- unique(df_S_stereo$Strain); if (length(strains) > 1) paste(length(strains), "strains") else paste(length(strains), "strain")}`

\* These outcomes were identified in the study protocol as primary outcomes of interest.

Only one publication reported each of prepulse inhibition (a primary outcome), social interaction, and stereotypy, and so these outcomes are not analysed further.

## 2.1 Outcome 1: Locomotor Activity

### 2.1.1 Risks of bias

Figure 2.1.1 shows the risk of bias summary for studies investigating the effect of administering a TAAR1 agonist on locomotor activity in animals. The risk of bias assessment was performed using the SyRCLE's RoB tool.

**Figure 2.1.1 - Traffic light plot of the risk of bias for locomotor activity**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE}
SyRCLE_RoB_traffic(df, "TvC", "Locomotor activity")
```

### 2.1.2 Reporting completeness

Figure 2.1.2 shows the reporting completeness summary for studies investigating the effect of administering a TAAR1 agonist on locomotor activity in animals. The reporting completeness assessment was performed using the ARRIVE guidelines. Studies which did not report are labelled 'High', those which did report are labelled 'Low'.

**Figure 2.1.2 - Traffic light plot of the reporting completeness for locomotor activity**

```{r message = FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height = 8}
ARRIVE_traffic(df, "TvC", "Locomotor activity")
```

### 2.1.3 Meta-analysis

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA <- run_ML_SMD(df, "TvC", "Locomotor activity", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
 if (any(class(SMD_S_LMA) == "rma.mv")) {
  output_text1 <- "The effect of administering a TAAR1 agonist on locomotor activity in animals using SMD as the effect size is shown in Figure 2.1.3. The pooled estimate for SMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate."
  output_text2 <- "Figure 2.1.3 - Forest plot of locomotor activity for TAAR1 Agonist vs control"

} else {
  output_text1 <- "Analysis is only performed if outcomes have been reported in more than one publication. There are not sufficient data for this outcome"
}
```

`r output_text1`

**`r output_text2`**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=22, fig.width=12}
forest_metafor(SMD_S_LMA, "TvC", "Locomotor activity")
```

```{r echo=FALSE}
 if (any(class(SMD_S_LMA) == "rma.mv")) {
  output_text3 <- paste0("For TAAR1 Agonist v Control, TAAR1 interventions had a pooled effect on locomotor activity of SMD = ", round(SMD_S_LMA[['beta']], 3), " (95% CI: ", round(SMD_S_LMA[['ci.lb']], 3), " to ", round(SMD_S_LMA[['ci.ub']], 3), ", with a prediction interval of ", round(predict(SMD_S_LMA)$pi.lb, 3), " to ", round(predict(SMD_S_LMA)$pi.ub, 3),").") 

} else {
  output_text3 <- ""

}
```

`r output_text3`

`r SMD_S_LMA[["k"]]` experimental comparisons were reported in `r length(unique(SMD_S_LMA$data$ExperimentID_I))` experiments reported from `r length(unique(SMD_S_LMA$data$StudyId))` publications and involving `r length(unique(SMD_S_LMA$data$Strain))` different animal strains.

The following table structure is used throughout this report and is used to show the different levels contributing to that analysis, the number of unique categories in those levels, and the variance contributed by that level of analysis. Because levels are only included in the analysis where there are five or more unique categories, for some analyses the number of categories is 0, and the variance attributed to those levels in not applicable. Because the model is hierarchical, where for instance there are Studies which include different Strains, the number of categories for Study x Strain will exceed the number of Studies (or publications) referred to in the text.

|            Level            |                                               Number of categories for that level included in this analysis                                               |                                                                   Attributable variance                                                                   |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA$s.names, SMD_S_LMA$s.nlevels[[which(SMD_S_LMA$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA$s.names, SMD_S_LMA$sigma2[[which(SMD_S_LMA$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA$s.names, SMD_S_LMA$s.nlevels[[which(SMD_S_LMA$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA$s.names, SMD_S_LMA$sigma2[[which(SMD_S_LMA$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA$s.names, SMD_S_LMA$s.nlevels[[which(SMD_S_LMA$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA$s.names, SMD_S_LMA$sigma2[[which(SMD_S_LMA$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

### 2.1.4 Subgroup analyses and meta-regressions

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
options(scipen=100, digits=3)
```

For each outcome, the covariates of interest for subgroup analyses and meta-regressions were:

-   **Sex**

-   **Method of disease induction**

-   **Route of intervention administration**

-   **Whether the intervention was prophylactic or therapeutic (i.e. administered before or after disease model induction)**

-   **Duration of treatment period**

-   **The intervention administered**

-   **The efficacy of the drug (i.e. whether the drug is a partial or full agonist)**

-   **The selectivity of the drug**

-   **Potency of the intervention**

-   **Dose of intervention**

We also conducted subgroup analyses using **(1) SyRCLE Risk of Bias** and **(2) ARRIVE reporting completeness** assessment scores as covariates to evaluate their influence on effect size estimates. These were not specified in the study protocol, but evaluation of risk of bias is required for the Summary of Evidence table, and no studies were considered at low risk of bias or high reporting completeness to allow such a sensitivity analysis

Only 21% of studies overall reported either a mean age, or an age range, of the experimental animals, so this was not analysed further.

The significance (p value) reported is that for a test of whether the moderators are significantly different one from another, rather than whether the effect is significantly different from 0.

#### Sex

Figure 2.1.4.1 displays the estimates for the pooled SMD's when comparisons are stratified by sex of the animal. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.1 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by sex**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_sex <- subgroup_analysis(df, "TvC", "Locomotor activity", "Sex", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_sex$plotdata, "Sex", "Locomotor Activity","Sex")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_sex_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "Sex", 0.5)
```

The p-value for the association between the sex of animal groups used and outcome reported was `r round(SMD_S_LMA_sex_noI$QMp,3)`.

|            Level            |                                                                  Number of categories for that level included in this analysis                                                                   |                                                                                      Attributable variance                                                                                       |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_sex$analysis$s.names, SMD_S_LMA_sex$analysis$s.nlevels[[which(SMD_S_LMA_sex$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_sex$analysis$s.names, SMD_S_LMA_sex$analysis$sigma2[[which(SMD_S_LMA_sex$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_sex$analysis$s.names, SMD_S_LMA_sex$analysis$s.nlevels[[which(SMD_S_LMA_sex$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_sex$analysis$s.names, SMD_S_LMA_sex$analysis$sigma2[[which(SMD_S_LMA_sex$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_sex$analysis$s.names, SMD_S_LMA_sex$analysis$s.nlevels[[which(SMD_S_LMA_sex$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_sex$analysis$s.names, SMD_S_LMA_sex$analysis$sigma2[[which(SMD_S_LMA_sex$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Category of disease induction

Figure 2.1.4.2 displays the estimates for the pooled SMD's when comparisons are stratified by the category of disease induction. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.2 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by category of disease induction**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', fig.width=20, fig.height=4}
SMD_S_LMA_CatDisInd <- subgroup_analysis(df, "TvC", "Locomotor activity", "CategoryDiseaseInduction", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_CatDisInd$plotdata, "CategoryDiseaseInduction", "Locomotor Activity","Category of \nDisease Induction")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_CatDisInd_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "CategoryDiseaseInduction", 0.5)
```

The p-value for the association between whether genetic or pharmacological models were used and outcome reported was `r round(SMD_S_LMA_CatDisInd_noI$QMp,3)`.

|            Level            |                                                                           Number of categories for that level included in this analysis                                                                            |                                                                                               Attributable variance                                                                                                |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_CatDisInd$analysis$s.names, SMD_S_LMA_CatDisInd$analysis$s.nlevels[[which(SMD_S_LMA_CatDisInd$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_CatDisInd$analysis$s.names, SMD_S_LMA_CatDisInd$analysis$sigma2[[which(SMD_S_LMA_CatDisInd$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_CatDisInd$analysis$s.names, SMD_S_LMA_CatDisInd$analysis$s.nlevels[[which(SMD_S_LMA_CatDisInd$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_CatDisInd$analysis$s.names, SMD_S_LMA_CatDisInd$analysis$sigma2[[which(SMD_S_LMA_CatDisInd$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_CatDisInd$analysis$s.names, SMD_S_LMA_CatDisInd$analysis$s.nlevels[[which(SMD_S_LMA_CatDisInd$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_CatDisInd$analysis$s.names, SMD_S_LMA_CatDisInd$analysis$sigma2[[which(SMD_S_LMA_CatDisInd$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Route of intervention administration

Figure 2.1.4.3 displays the estimates for the pooled SMD's when comparisons are stratified by the route of intervention administration. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.3 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by route of intervention administration**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_AdminRoute <- subgroup_analysis(df, "TvC", "Locomotor activity", "InterventionAdministrationRoute", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_AdminRoute$plotdata, "InterventionAdministrationRoute", "Locomotor Activity","Route of \nAdministration")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_AdminRoute_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "InterventionAdministrationRoute", 0.5)
```

The p-value for the association between the route of intervention administration and outcome reported was `r round(SMD_S_LMA_AdminRoute_noI$QMp,3)`.

|            Level            |                                                                             Number of categories for that level included in this analysis                                                                             |                                                                                                 Attributable variance                                                                                                 |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_AdminRoute$analysis$s.names, SMD_S_LMA_AdminRoute$analysis$s.nlevels[[which(SMD_S_LMA_AdminRoute$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_AdminRoute$analysis$s.names, SMD_S_LMA_AdminRoute$analysis$sigma2[[which(SMD_S_LMA_AdminRoute$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_AdminRoute$analysis$s.names, SMD_S_LMA_AdminRoute$analysis$s.nlevels[[which(SMD_S_LMA_AdminRoute$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_AdminRoute$analysis$s.names, SMD_S_LMA_AdminRoute$analysis$sigma2[[which(SMD_S_LMA_AdminRoute$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_AdminRoute$analysis$s.names, SMD_S_LMA_AdminRoute$analysis$s.nlevels[[which(SMD_S_LMA_AdminRoute$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_AdminRoute$analysis$s.names, SMD_S_LMA_AdminRoute$analysis$sigma2[[which(SMD_S_LMA_AdminRoute$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Prophylactic or therapeutic intervention

Figure 2.1.4.4 displays the estimates for the pooled SMD's when comparisons are stratified by whether the intervention was administered prophylactically or therapeutically. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot. This categorisation is co-linear with that for route of administration - all treatments given after the induction of locomotor activity were given intraperitoneally.

**Figure 2.1.4.4 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by intervention type**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_ProphThera <- subgroup_analysis(df, "TvC", "Locomotor activity", "ProphylacticOrTherapeutic", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_ProphThera$plotdata, "ProphylacticOrTherapeutic", "Locomotor Activity","Treatment before \nor after model induction")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_ProphThera_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "ProphylacticOrTherapeutic", 0.5)
```

The p-value for the association between whether the intervention was administered prophylactically or therapeutically and outcome reported was `r round(SMD_S_LMA_ProphThera_noI$QMp,3)`.

|            Level            |                                                                             Number of categories for that level included in this analysis                                                                             |                                                                                                 Attributable variance                                                                                                 |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_ProphThera$analysis$s.names, SMD_S_LMA_ProphThera$analysis$s.nlevels[[which(SMD_S_LMA_ProphThera$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_ProphThera$analysis$s.names, SMD_S_LMA_ProphThera$analysis$sigma2[[which(SMD_S_LMA_ProphThera$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_ProphThera$analysis$s.names, SMD_S_LMA_ProphThera$analysis$s.nlevels[[which(SMD_S_LMA_ProphThera$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_ProphThera$analysis$s.names, SMD_S_LMA_ProphThera$analysis$sigma2[[which(SMD_S_LMA_ProphThera$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_ProphThera$analysis$s.names, SMD_S_LMA_ProphThera$analysis$s.nlevels[[which(SMD_S_LMA_ProphThera$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_ProphThera$analysis$s.names, SMD_S_LMA_ProphThera$analysis$sigma2[[which(SMD_S_LMA_ProphThera$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Duration of treatment period

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', fig.width=9, fig.height=3}
SMD_S_LMA_DurRx <- subgroup_analysis(df, "TvC", "Locomotor activity", "TreatmentDurationCategory", 0.5)
```

```{r echo=FALSE}
 if (any(class(SMD_S_LMA_DurRx) == "rma.mv")) {
  output_text1 <- "Figure 2.1.4.5 displays the estimates for the pooled SMD's when comparisons are stratified by duration of treatment. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD, not stratified by whether the intervention was administered prophylactically or therapeutically, is displayed as a diamond shape at the bottom of the plot."
  output_text2 <- "Figure 2.1.4.5 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by duration of treatment"
} else {
  output_text1 <- "In this iteration of the review, all relevant comparisons administered the TAAR1 agonist for < 1 week. Therefore, no subgroup analyses were conducted for this variable."
  output_text2 <- ""
}
```

`r output_text1`

**`r output_text2`**

```{r echo = FALSE}
 if (any(class(class(SMD_S_LMA_DurRx)) == "rma.mv")) {
  output_text3 <- paste0(`r SMD_S_LMA_DurRx[SMD_S_LMA_DurRx$TreatmentDurationCategory == "Less than 1 week", "k"]`,"comparisons administered the TAAR1 agonist for less than one week, ", `r SMD_S_LMA_DurRx[SMD_S_LMA_DurRx$TreatmentDurationCategory == "Between 1-4 weeks", "k"]`," for between 1 and 4 weeks, and ",`r SMD_S_LMA_DurRx[SMD_S_LMA_DurRx$TreatmentDurationCategory == "More than 4 weeks", "k"]`," for more than 4 weeks.")
  output_text4 <- paste0("The pooled SMD estimate for experiments administering the TAAR1 agonist for less than 1 week was ",`r SMD_S_LMA_DurRx[SMD_S_LMA_DurRx$TreatmentDurationCategory == "Less than 1 week", "SMD"]`," for 1 to 4 weeks was ",`r SMD_S_LMA_DurRx[SMD_S_LMA_DurRx$TreatmentDurationCategory == "Between 1-4 weeks", "SMD"]`," and for experiments administering the TAAR1 agonist for more than 4 weeks was ",`r SMD_S_LMA_DurRx[SMD_S_LMA_DurRx$TreatmentDurationCategory == "More than 4 weeks", "SMD"]`,".")

} else {
  output_text3 <- ""
  output_text4 <- ""
}

```

#### The intervention administered

Figure 2.1.4.6 displays the estimates for the pooled SMD's when comparisons are stratified by the intervention administered. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.6 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by intervention administered**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_Drug <- subgroup_analysis(df, "TvC", "Locomotor activity", "DrugName", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_Drug$plotdata, "DrugName", "Locomotor Activity","Drug")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_Drug_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "DrugName", 0.5)
```

The p-value for the association between the intervention and outcome reported was `r round(SMD_S_LMA_Drug_noI$QMp,3)`.

|            Level            |                                                                    Number of categories for that level included in this analysis                                                                    |                                                                                        Attributable variance                                                                                        |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_Drug$analysis$s.names, SMD_S_LMA_Drug$analysis$s.nlevels[[which(SMD_S_LMA_Drug$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_Drug$analysis$s.names, SMD_S_LMA_Drug$analysis$sigma2[[which(SMD_S_LMA_Drug$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_Drug$analysis$s.names, SMD_S_LMA_Drug$analysis$s.nlevels[[which(SMD_S_LMA_Drug$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_Drug$analysis$s.names, SMD_S_LMA_Drug$analysis$sigma2[[which(SMD_S_LMA_Drug$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_Drug$analysis$s.names, SMD_S_LMA_Drug$analysis$s.nlevels[[which(SMD_S_LMA_Drug$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_Drug$analysis$s.names, SMD_S_LMA_Drug$analysis$sigma2[[which(SMD_S_LMA_Drug$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### The efficacy of the drug (i.e. whether the drug is a partial or full agonist)

Figure 2.1.4.7 displays the estimates for the pooled SMD's when comparisons are stratified by the action/efficacy of the intervention administered. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.7 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by efficacy of the drug**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_DrugEfficacy <- subgroup_analysis(df, "TvC", "Locomotor activity", "Efficacy", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_DrugEfficacy$plotdata, "Efficacy", "Locomotor Activity","Full or\n Partial Agonist")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_DrugEfficacy_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "Efficacy", 0.5)
```

The p-value for the association between whether the drug was a full or partial agonist and outcome reported was `r round(SMD_S_LMA_DrugEfficacy_noI$QMp,3)`.

|            Level            |                                                                                Number of categories for that level included in this analysis                                                                                |                                                                                                    Attributable variance                                                                                                    |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_DrugEfficacy$analysis$s.names, SMD_S_LMA_DrugEfficacy$analysis$s.nlevels[[which(SMD_S_LMA_DrugEfficacy$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_DrugEfficacy$analysis$s.names, SMD_S_LMA_DrugEfficacy$analysis$sigma2[[which(SMD_S_LMA_DrugEfficacy$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_DrugEfficacy$analysis$s.names, SMD_S_LMA_DrugEfficacy$analysis$s.nlevels[[which(SMD_S_LMA_DrugEfficacy$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_DrugEfficacy$analysis$s.names, SMD_S_LMA_DrugEfficacy$analysis$sigma2[[which(SMD_S_LMA_DrugEfficacy$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_DrugEfficacy$analysis$s.names, SMD_S_LMA_DrugEfficacy$analysis$s.nlevels[[which(SMD_S_LMA_DrugEfficacy$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_DrugEfficacy$analysis$s.names, SMD_S_LMA_DrugEfficacy$analysis$sigma2[[which(SMD_S_LMA_DrugEfficacy$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### The selectivity of the drug

Figure 2.1.4.8 displays the estimates for the pooled SMD's when comparisons are stratified by the selectivity of the intervention administered. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.8 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by selectivity of the drug**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_DrugSelectivity <- subgroup_analysis(df, "TvC", "Locomotor activity", "Selectivity", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_DrugSelectivity$plotdata, "Selectivity", "Locomotor Activity","High or\nLow Selectivity")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_DrugSelectivity_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "Selectivity", 0.5)
```

The p-value for the association between whether the drug was highly selective, or also manifests 5-HT1A effects, and outcome reported was `r round(SMD_S_LMA_DrugSelectivity_noI$QMp,3)`.

|            Level            |                                                                                    Number of categories for that level included in this analysis                                                                                     |                                                                                                        Attributable variance                                                                                                         |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_DrugSelectivity$analysis$s.names, SMD_S_LMA_DrugSelectivity$analysis$s.nlevels[[which(SMD_S_LMA_DrugSelectivity$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_DrugSelectivity$analysis$s.names, SMD_S_LMA_DrugSelectivity$analysis$sigma2[[which(SMD_S_LMA_DrugSelectivity$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_DrugSelectivity$analysis$s.names, SMD_S_LMA_DrugSelectivity$analysis$s.nlevels[[which(SMD_S_LMA_DrugSelectivity$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_DrugSelectivity$analysis$s.names, SMD_S_LMA_DrugSelectivity$analysis$sigma2[[which(SMD_S_LMA_DrugSelectivity$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_DrugSelectivity$analysis$s.names, SMD_S_LMA_DrugSelectivity$analysis$s.nlevels[[which(SMD_S_LMA_DrugSelectivity$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_DrugSelectivity$analysis$s.names, SMD_S_LMA_DrugSelectivity$analysis$sigma2[[which(SMD_S_LMA_DrugSelectivity$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Potency of intervention

The pEC50 value of each drug was used to measure potency. The pEC50 value is the negative logarithm (to base 10) of the EC50 value. Higher pEC50 values indicate higher potency (as they indicate a lower EC50). Figure 2.1.4.9 displays a visualisation of the meta-regression using the pEC50 value as an explanatory variable. Dashed lines represent the 95% confidence interval of the regression line. The dotted lines represent the 95% prediction interval. Raw data are plotted with 'bubble' size adjusted according to effect size precision.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_potency <- metaregression_analysis(df, "TvC", "Locomotor activity", "pE50", 0.5)

```

**Figure 2.1.4.9 - Meta-regression of TAAR1 agonist vs control on locomotor activity by potency of intervention**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE,}
SMD_S_LMA_potency$regression_plot
```

The estimate for $\beta$ was `r SMD_S_LMA_potency$metaregression_summary$beta[2]` (p = `r  round(SMD_S_LMA_potency$metaregression_summary$pval[2],3)`).

|            Level            |                                                                                             Number of categories for that level included in this analysis                                                                                              |                                                                                                                 Attributable variance                                                                                                                  |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_potency$metaregression_summary$s.names, SMD_S_LMA_potency$metaregression_summary$s.nlevels[[which(SMD_S_LMA_potency$metaregression_summary$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_potency$metaregression_summary$s.names, SMD_S_LMA_potency$metaregression_summary$sigma2[[which(SMD_S_LMA_potency$metaregression_summary$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_potency$metaregression_summary$s.names, SMD_S_LMA_potency$metaregression_summary$s.nlevels[[which(SMD_S_LMA_potency$metaregression_summary$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_potency$metaregression_summary$s.names, SMD_S_LMA_potency$metaregression_summary$sigma2[[which(SMD_S_LMA_potency$metaregression_summary$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_potency$metaregression_summary$s.names, SMD_S_LMA_potency$metaregression_summary$s.nlevels[[which(SMD_S_LMA_potency$metaregression_summary$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_potency$metaregression_summary$s.names, SMD_S_LMA_potency$metaregression_summary$sigma2[[which(SMD_S_LMA_potency$metaregression_summary$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Dose of intervention

In this iteration of the review, the TAAR1 agonists tested against control for their effect on locomotor activity were: **`r drugs <- df %>% filter(SortLabel == "TvC") %>% filter(outcome_type == "Locomotor activity") %>% group_by(DrugName) %>% summarise(count = n()) %>% arrange(desc(count)) %>% pull(DrugName); if (length(drugs) > 1) {paste(paste(head(drugs, -1), collapse = ", "), "and", tail(drugs, 1))} else {drugs}`**. Meta-analysis was conducted where data were available from more than nine experiments in more than two publications. The dashed lines in the plot represent the 95% confidence interval of the regression line and the dotted lines represent the 95% prediction interval. Raw data are plotted with point size adjusted according to effect size precision.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_RO5203648_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "RO5203648", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "RO5203648") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5203648: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_RO5203648_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "RO5203648")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_RO5263397_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "RO5263397", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "RO5263397") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5263397: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_RO5263397_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "RO5263397")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_SEP363856_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "SEP-363856", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "SEP-363856") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("SEP-363856 (Ultaront): There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_SEP363856_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "SEP-363856")
```

The estimate for $\beta$ was `r SMD_S_LMA_SEP363856_dose$beta[2]` (p = `r  round(SMD_S_LMA_SEP363856_dose$pval[2],3)`).

|            Level            |                                                                     Number of categories for that level included in this analysis                                                                      |                                                                                         Attributable variance                                                                                          |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_SEP363856_dose$s.names, SMD_S_LMA_SEP363856_dose$s.nlevels[[which(SMD_S_LMA_SEP363856_dose$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_SEP363856_dose$s.names, SMD_S_LMA_SEP363856_dose$sigma2[[which(SMD_S_LMA_SEP363856_dose$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_SEP363856_dose$s.names, SMD_S_LMA_SEP363856_dose$s.nlevels[[which(SMD_S_LMA_SEP363856_dose$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_SEP363856_dose$s.names, SMD_S_LMA_SEP363856_dose$sigma2[[which(SMD_S_LMA_SEP363856_dose$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_SEP363856_dose$s.names, SMD_S_LMA_SEP363856_dose$s.nlevels[[which(SMD_S_LMA_SEP363856_dose$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_SEP363856_dose$s.names, SMD_S_LMA_SEP363856_dose$sigma2[[which(SMD_S_LMA_SEP363856_dose$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_RO5166017_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "RO5166017", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "RO5166017") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5166017: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_RO5166017_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "RO5166017")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_LK000764_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "LK000764", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "LK000764") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("LK000764: There were ", diag3 <- nrow(diag1), " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_LK000764_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "LK000764")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_RO5256390_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "RO5256390", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "RO5256390") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5256390: There were ", diag3 <- nrow(diag1), " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_RO5256390_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "RO5256390")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_Compound50B_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "Compound 50B", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "Compound 50B") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("Compound 50B: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_Compound50B_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "Compound 50B")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_Compound50A_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "Compound 50A", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "Compound 50A") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("Compound 50A: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_Compound50A_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "Compound 50A")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_RO5073012_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "RO5073012", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "RO5073012") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5073012: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_RO5073012_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "RO5073012")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_AP163_dose <- metaregression_analysis_by_drug(df, "TvC", "Locomotor activity", "AP163", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Locomotor activity") %>%
filter(DrugName == "AP163") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("AP163: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_LMA_AP163_dose, df, "TvC", "Locomotor activity","DoseOfIntervention_mgkg", "AP163")
```

##### Standardised dose

We then sought evidence of a dose response relationship across all drugs. To do this, we conducted meta-regression using a constructed variable, the 'standardised dose'. The EC50 of a drug is the molar concentration at which 50% of the maximal response occurs. While the drug concentrations achieved at the receptor are unknown, we can approximate this from the dose given (expressed as g/kg), and the molar mass of the drug (g/mol). This relies on an approximation that the drug is equally distributed throughout the animal, and so does not take into account for example first pass metabolism for orally administered drugs, blood brain barrier solubility or differential accumulation in fatty tissues. As such, it should be interpreted with extreme caution; but does provide allow some imputation of whether, across all drugs, there is a dose-response effect. On this measure, a standardised dose of 0 would reflect 50% of maximum effect and a standardised dose of 1 would reflect around 80% of maximum effect

The standardised dose was calculated as the logarithm of the dose of the intervention (in g/kg) divided by the product of the intervention's EC50 (in moles) and the Molar mass of the drug (in g/mol):

$$
\log\frac{(\text{Dose of Intervention (g/kg)})}{(\text{Molar Mass (g/mol)}) \times ({\text{EC50 (mol/l)}})}
$$

**This is a simplified approximation based on the reasoning that if drug actions are mediated through the TAAR1 receptor, and drug efficacy is reflected in the respective EC50 values, then in principal drugs should exhibit similar effects when acting at their respective EC50.**

The actual concentration of a drug at the receptor site is influenced by several variables, including dosage, administration route, elimination half-life, and first-pass metabolism (in case of oral administration). Incorporating all these factors accurately would necessitate a detailed pharmacokinetic model, which falls outside the scope of this review. Here, we assume uniformity across experiments in terms of (i) volume of distribution, (ii) first-pass metabolism, (iii) blood-brain barrier permeability, and (iv) experimental design, especially regarding the timing of peak drug concentration (where we assume that experiments were designed to be done at a time when the drug was near peak concentration). We recognise the limitations of this approach, the findings of which should be interpreted with caution.

Figure 2.1.4.10 provides a visualisation of the meta-regression analysis relationship between standardised doses of TAAR1 agonists and the Standardized Mean Difference (SMD) change in Locomotor activity. As before, dashed lines represent the 95% confidence interval of the regression line and dotted lines represent the 95% prediction interval. Raw data are plotted with point size adjusted according to effect size precision.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}

SMD_S_LMA_StandardDose <- metaregression_analysis(df, "TvC", "Locomotor activity", "StandardisedDose", 0.5)

```

**Figure 2.1.4.10 - Meta regression of standardised dose for TAAR1 agonist vs control on locomotor activity**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE,}
SMD_S_LMA_StandardDose$regression_plot
```

The estimate for the change in effect per log unit change in standardised dose was `r round(SMD_S_LMA_StandardDose$metaregression_summary$beta[2],3)` (p `r if(round(SMD_S_LMA_StandardDose[["metaregression"]][["pval"]][2],3)>0.001){paste0('= ',round(SMD_S_LMA_StandardDose[["metaregression"]][["pval"]][2],3))}else{'< 0.001'}`).

|            Level            |                                                                                                     Number of categories for that level included in this analysis                                                                                                     |                                                                                                                         Attributable variance                                                                                                                         |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_StandardDose$metaregression_summary$s.names, SMD_S_LMA_StandardDose$metaregression_summary$s.nlevels[[which(SMD_S_LMA_StandardDose$metaregression_summary$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_StandardDose$metaregression_summary$s.names, SMD_S_LMA_StandardDose$metaregression_summary$sigma2[[which(SMD_S_LMA_StandardDose$metaregression_summary$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_StandardDose$metaregression_summary$s.names, SMD_S_LMA_StandardDose$metaregression_summary$s.nlevels[[which(SMD_S_LMA_StandardDose$metaregression_summary$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_StandardDose$metaregression_summary$s.names, SMD_S_LMA_StandardDose$metaregression_summary$sigma2[[which(SMD_S_LMA_StandardDose$metaregression_summary$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_StandardDose$metaregression_summary$s.names, SMD_S_LMA_StandardDose$metaregression_summary$s.nlevels[[which(SMD_S_LMA_StandardDose$metaregression_summary$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_StandardDose$metaregression_summary$s.names, SMD_S_LMA_StandardDose$metaregression_summary$sigma2[[which(SMD_S_LMA_StandardDose$metaregression_summary$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### SyRCLE RoB assessment considered as a categorical variable

Figure 2.1.4.11 displays the estimates for the pooled SMD's when comparisons are stratified by how many of the SyRCLE risk of bias assessment criteria (of which there are 10) that the experiment met. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.11 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by SyRCLE RoB criteria met**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_LMA_SyRCLERoB <- subgroup_analysis(df, "TvC", "Locomotor activity", "RoBScore", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_SyRCLERoB$plotdata, "RoBScore", "Locomotor Activity","SyRCLE RoB score")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_SyRCLERoB_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "RoBScore", 0.5)
```

The p-value for the association between SyRCLE Risks of Bias reporting and outcome reported was `r round(SMD_S_LMA_SyRCLERoB_noI$QMp,3)`.

|            Level            |                                                                           Number of categories for that level included in this analysis                                                                            |                                                                                               Attributable variance                                                                                                |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_SyRCLERoB$analysis$s.names, SMD_S_LMA_SyRCLERoB$analysis$s.nlevels[[which(SMD_S_LMA_SyRCLERoB$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_SyRCLERoB$analysis$s.names, SMD_S_LMA_SyRCLERoB$analysis$sigma2[[which(SMD_S_LMA_SyRCLERoB$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_SyRCLERoB$analysis$s.names, SMD_S_LMA_SyRCLERoB$analysis$s.nlevels[[which(SMD_S_LMA_SyRCLERoB$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_SyRCLERoB$analysis$s.names, SMD_S_LMA_SyRCLERoB$analysis$sigma2[[which(SMD_S_LMA_SyRCLERoB$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_SyRCLERoB$analysis$s.names, SMD_S_LMA_SyRCLERoB$analysis$s.nlevels[[which(SMD_S_LMA_SyRCLERoB$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_SyRCLERoB$analysis$s.names, SMD_S_LMA_SyRCLERoB$analysis$sigma2[[which(SMD_S_LMA_SyRCLERoB$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### SyRCLE RoB assessment considering those studies where any item is at low risk of bias

Figure 2.1.4.12 displays the estimates for the pooled SMD's when comparisons are stratified by whether of not any of the SyRCLE Risk of bias domains were rated as low risk of bias. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.1.4.12 - Subgroup analysis of TAAR1 agonist vs control on locomotor activity by alternative SyRCLE RoB assessment**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_LMA_SyRCLERoBTF <- subgroup_analysis(df, "TvC", "Locomotor activity", "RoBTF", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_LMA_SyRCLERoBTF$plotdata, "RoBTF", "Locomotor Activity","RoB score")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_SyRCLERoBTF_noI <- subgroup_SMD(df, "TvC", "Locomotor activity", "RoBTF", 0.5)
```

The p-value for the association between low SyRCLE Risks of Bias reporting and outcome reported was `r round(SMD_S_LMA_SyRCLERoBTF_noI$QMp,3)`.

|            Level            |                                                                              Number of categories for that level included in this analysis                                                                               |                                                                                                  Attributable variance                                                                                                   |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_SyRCLERoBTF$analysis$s.names, SMD_S_LMA_SyRCLERoBTF$analysis$s.nlevels[[which(SMD_S_LMA_SyRCLERoBTF$analysis$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_SyRCLERoBTF$analysis$s.names, SMD_S_LMA_SyRCLERoBTF$analysis$sigma2[[which(SMD_S_LMA_SyRCLERoBTF$analysis$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_SyRCLERoBTF$analysis$s.names, SMD_S_LMA_SyRCLERoBTF$analysis$s.nlevels[[which(SMD_S_LMA_SyRCLERoBTF$analysis$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_SyRCLERoBTF$analysis$s.names, SMD_S_LMA_SyRCLERoBTF$analysis$sigma2[[which(SMD_S_LMA_SyRCLERoBTF$analysis$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_SyRCLERoBTF$analysis$s.names, SMD_S_LMA_SyRCLERoBTF$analysis$s.nlevels[[which(SMD_S_LMA_SyRCLERoBTF$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_SyRCLERoBTF$analysis$s.names, SMD_S_LMA_SyRCLERoBTF$analysis$sigma2[[which(SMD_S_LMA_SyRCLERoBTF$analysis$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### ARRIVE reporting completeness guidelines

Figure 2.1.4.13 displays a visualisation of the meta-regression using the number of ARRIVE items met (from a possible total of 22) as an explanatory variable. Dashed lines represent the 95% confidence interval of the regression line. The dotted lines represent the 95% prediction interval. Raw data are plotted with 'bubble' size adjusted according to effect size precision.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_ARR2 <- metaregression_analysis(df, "TvC", "Locomotor activity", "ARRIVEScore", 0.5)

```

**Figure 2.1.4.13 - Meta-regression of number of ARRIVE items met for TAAR1 agonist vs control on locomotor activity**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE,}
SMD_S_LMA_ARR2$regression_plot
```

The estimate for $\beta$ was `r SMD_S_LMA_ARR2$metaregression_summary$beta[2]` (p = `r  round(SMD_S_LMA_ARR2$metaregression_summary$pval[2],3)`).

|            Level            |                                                                                         Number of categories for that level included in this analysis                                                                                         |                                                                                                             Attributable variance                                                                                                             |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% SMD_S_LMA_ARR2$metaregression_summary$s.names, SMD_S_LMA_ARR2$metaregression_summary$s.nlevels[[which(SMD_S_LMA_ARR2$metaregression_summary$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% SMD_S_LMA_ARR2$metaregression_summary$s.names, SMD_S_LMA_ARR2$metaregression_summary$sigma2[[which(SMD_S_LMA_ARR2$metaregression_summary$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% SMD_S_LMA_ARR2$metaregression_summary$s.names, SMD_S_LMA_ARR2$metaregression_summary$s.nlevels[[which(SMD_S_LMA_ARR2$metaregression_summary$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% SMD_S_LMA_ARR2$metaregression_summary$s.names, SMD_S_LMA_ARR2$metaregression_summary$sigma2[[which(SMD_S_LMA_ARR2$metaregression_summary$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_ARR2$metaregression_summary$s.names, SMD_S_LMA_ARR2$metaregression_summary$s.nlevels[[which(SMD_S_LMA_ARR2$metaregression_summary$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% SMD_S_LMA_ARR2$metaregression_summary$s.names, SMD_S_LMA_ARR2$metaregression_summary$sigma2[[which(SMD_S_LMA_ARR2$metaregression_summary$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Heterogeneity explained by covariates (TAAR1 Agonist vs Control on locomotor activity)

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_LMA_sexI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "Sex", 0.5)
SMD_S_LMA_CatDisIndI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "CategoryDiseaseInduction", 0.5)
SMD_S_LMA_AdminRouteI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "InterventionAdministrationRoute", 0.5)
SMD_S_LMA_ProphTheraI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "ProphylacticOrTherapeutic", 0.5)
SMD_S_LMA_DurRxI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "TreatmentDurationCategory", 0.5)
SMD_S_LMA_DrugI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "DrugName", 0.5)
SMD_S_LMA_SyRCLERoBI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "RoBScore", 0.5)
SMD_S_LMA_ARRIVEI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "ARRIVEScoreCat", 0.5)
SMD_S_LMA_DrugI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "DrugName", 0.5)
SMD_S_LMA_DrugEfficacyI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "Efficacy", 0.5)
SMD_S_LMA_DrugSelectivityI <- subgroup_SMDI(df, "TvC", "Locomotor activity", "Selectivity", 0.5)
```

The table below summarises the heterogeneity observed for each covariate in the effect sizes of the effect of TAAR1 agonists on locomotor activity. We present marginal R^2^ (the % change in the between-studies variance when the covariate is included in the model), which measures the proportion of variance explained by including moderators in the model . The coefficients are derived from an rma model fitted with an intercept (and so represent, for each category, the point estimate and 95% CIs of the effect in that category).

|                Moderator                 |        Category         |                      $\beta$                      |                                                  95% CI                                                  |                          Marginal R^2^ (%)                          |
|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
|              Overall effect              |           \-            |               `r SMD_S_LMA$beta[1]`               |                                `r SMD_S_LMA$ci.lb` to `r SMD_S_LMA$ci.ub`                                |                                 \-                                  |
|                   Sex                    |           \-            |                        \-                         |                                                    \-                                                    |            `r round((r2_ml(SMD_S_LMA_sexI)[1]*100),1)`%             |
|                    \-                    |        *Female*         |            `r SMD_S_LMA_sexI$beta[1]`             |                        `r SMD_S_LMA_sexI$ci.lb[1]` to `r SMD_S_LMA_sexI$ci.ub[1]`                        |                                 \-                                  |
|                    \-                    |         *Male*          |            `r SMD_S_LMA_sexI$beta[2]`             |                        `r SMD_S_LMA_sexI$ci.lb[2]` to `r SMD_S_LMA_sexI$ci.ub[2]`                        |                                 \-                                  |
|                    \-                    |         *Mixed*         |            `r SMD_S_LMA_sexI$beta[3]`             |                        `r SMD_S_LMA_sexI$ci.lb[3]` to `r SMD_S_LMA_sexI$ci.ub[3]`                        |                                 \-                                  |
|                    \-                    |     *Not reported*      |            `r SMD_S_LMA_sexI$beta[4]`             |                        `r SMD_S_LMA_sexI$ci.lb[4]` to `r SMD_S_LMA_sexI$ci.ub[4]`                        |                                 \-                                  |
|   Category of disease model induction    |           \-            |                        \-                         |                                                    \-                                                    |         `r round((r2_ml(SMD_S_LMA_CatDisIndI)[1]*100),1)`%          |
|                    \-                    |        *Genetic*        |         `r SMD_S_LMA_CatDisIndI$beta[1]`          |              `r SMD_S_LMA_CatDisIndI$ci.lb[1]` to `r SMD_S_LMA_CatDisInd$analysis$ci.ub[1]`              |                                 \-                                  |
|                    \-                    |    *Pharmacological*    |         `r SMD_S_LMA_CatDisIndI$beta[2]`          |                  `r SMD_S_LMA_CatDisIndI$ci.lb[2]` to `r SMD_S_LMA_CatDisIndI$ci.ub[2]`                  |                                 \-                                  |
|           Administration route           |           \-            |                        \-                         |                                                    \-                                                    |         `r round((r2_ml(SMD_S_LMA_AdminRouteI)[1]*100),1)`%         |
|                    \-                    |    *Intraperitoneal*    |         `r SMD_S_LMA_AdminRouteI$beta[1]`         |                 `r SMD_S_LMA_AdminRouteI$ci.lb[1]` to `r SMD_S_LMA_AdminRouteI$ci.ub[1]`                 |                                 \-                                  |
|                    \-                    |         *Oral*          |         `r SMD_S_LMA_AdminRouteI$beta[2]`         |                 `r SMD_S_LMA_AdminRouteI$ci.lb[2]` to `r SMD_S_LMA_AdminRouteI$ci.ub[2]`                 |                                 \-                                  |
| Prophylactic or therapeutic intervention |           \-            |                        \-                         |                                                    \-                                                    |         `r round((r2_ml(SMD_S_LMA_ProphTheraI)[1]*100),1)`%         |
|                    \-                    |     *Prophylactic*      |         `r SMD_S_LMA_ProphTheraI$beta[1]`         |                 `r SMD_S_LMA_ProphTheraI$ci.lb[1]` to `r SMD_S_LMA_ProphTheraI$ci.ub[1]`                 |                                 \-                                  |
|                    \-                    |      *Therapeutic*      |         `r SMD_S_LMA_ProphTheraI$beta[2]`         |                 `r SMD_S_LMA_ProphTheraI$ci.lb[2]` to `r SMD_S_LMA_ProphTheraI$ci.ub[2]`                 |                                 \-                                  |
|        Intervention administered         |           \-            |                        \-                         |                                                    \-                                                    |            `r round((r2_ml(SMD_S_LMA_DrugI)[1]*100),1)`%            |
|                    \-                    |         *AP163*         |            `r SMD_S_LMA_DrugI$beta[1]`            |                       `r SMD_S_LMA_DrugI$ci.lb[1]` to `r SMD_S_LMA_DrugI$ci.ub[1]`                       |                                 \-                                  |
|                    \-                    |     *Compound 50A*      |            `r SMD_S_LMA_DrugI$beta[2]`            |                       `r SMD_S_LMA_DrugI$ci.lb[2]` to `r SMD_S_LMA_DrugI$ci.ub[2]`                       |                                 \-                                  |
|                    \-                    |     *Compound 50B*      |            `r SMD_S_LMA_DrugI$beta[3]`            |               `r SMD_S_LMA_Drug$analysis$ci.lb[3]` to `r SMD_S_LMA_Drug$analysis$ci.ub[3]`               |                                 \-                                  |
|                    \-                    |       *LK000764*        |            `r SMD_S_LMA_DrugI$beta[4]`            |                       `r SMD_S_LMA_DrugI$ci.lb[4]` to `r SMD_S_LMA_DrugI$ci.ub[4]`                       |                                 \-                                  |
|                    \-                    |       *RO5073012*       |            `r SMD_S_LMA_DrugI$beta[5]`            |                       `r SMD_S_LMA_DrugI$ci.lb[5]` to `r SMD_S_LMA_DrugI$ci.ub[5]`                       |                                 \-                                  |
|                    \-                    |       *RO5166017*       |            `r SMD_S_LMA_DrugI$beta[6]`            |                       `r SMD_S_LMA_DrugI$ci.lb[6]` to `r SMD_S_LMA_DrugI$ci.ub[6]`                       |                                 \-                                  |
|                    \-                    |       *RO5203648*       |            `r SMD_S_LMA_DrugI$beta[7]`            |                       `r SMD_S_LMA_DrugI$ci.lb[7]` to `r SMD_S_LMA_DrugI$ci.ub[7]`                       |                                 \-                                  |
|                    \-                    |       *RO5256390*       |            `r SMD_S_LMA_DrugI$beta[8]`            |                       `r SMD_S_LMA_DrugI$ci.lb[8]` to `r SMD_S_LMA_DrugI$ci.ub[8]`                       |                                 \-                                  |
|                    \-                    |       *RO5263397*       |            `r SMD_S_LMA_DrugI$beta[9]`            |                       `r SMD_S_LMA_DrugI$ci.lb[9]` to `r SMD_S_LMA_DrugI$ci.ub[9]`                       |                                 \-                                  |
|                    \-                    | *SEP-363856 (Ultaront)* |           `r SMD_S_LMA_DrugI$beta[10]`            |                      `r SMD_S_LMA_DrugI$ci.lb[10]` to `r SMD_S_LMA_DrugI$ci.ub[10]`                      |                                 \-                                  |
|              Drug efficacy               |           \-            |                        \-                         |                                                    \-                                                    |        `r round((r2_ml(SMD_S_LMA_DrugEfficacyI)[1]*100),1)`%        |
|                    \-                    |     *Full agonist*      |        `r SMD_S_LMA_DrugEfficacyI$beta[1]`        |               `r SMD_S_LMA_DrugEfficacyI$ci.lb[1]` to `r SMD_S_LMA_DrugEfficacyI$ci.ub[1]`               |                                 \-                                  |
|                    \-                    |    *Partial agonist*    |        `r SMD_S_LMA_DrugEfficacyI$beta[2]`        |               `r SMD_S_LMA_DrugEfficacyI$ci.lb[2]` to `r SMD_S_LMA_DrugEfficacyI$ci.ub[2]`               |                                 \-                                  |
|             Drug selectivity             |           \-            |                        \-                         |                                                    \-                                                    |      `r round((r2_ml(SMD_S_LMA_DrugSelectivityI)[1]*100),1)`%       |
|                    \-                    |         *High*          |      `r SMD_S_LMA_DrugSelectivityI$beta[1]`       |            `r SMD_S_LMA_DrugSelectivityI$ci.lb[1]` to `r SMD_S_LMA_DrugSelectivityI$ci.ub[1]`            |                                 \-                                  |
|                    \-                    |          *Low*          |      `r SMD_S_LMA_DrugSelectivityI$beta[2]`       |            `r SMD_S_LMA_DrugSelectivityI$ci.lb[2]` to `r SMD_S_LMA_DrugSelectivityI$ci.ub[2]`            |                                 \-                                  |
|                    \-                    |        *Unclear*        |      `r SMD_S_LMA_DrugSelectivityI$beta[3]`       |            `r SMD_S_LMA_DrugSelectivityI$ci.lb[3]` to `r SMD_S_LMA_DrugSelectivityI$ci.ub[3]`            |                                 \-                                  |
|               Drug potency               |      per log unit       |   `r SMD_S_LMA_potency$metaregression$beta[2]`    |      `r SMD_S_LMA_potency$metaregression$ci.lb[2]` to `r SMD_S_LMA_potency$metaregression$ci.ub[2]`      |   `r round((r2_ml(SMD_S_LMA_potency$metaregression)[1]*100),1)`%    |
|          Standardised drug dose          |      per log unit       | `r SMD_S_LMA_StandardDose$metaregression$beta[2]` | `r SMD_S_LMA_StandardDose$metaregression$ci.lb[2]` to `r SMD_S_LMA_StandardDose$metaregression$ci.ub[2]` | `r round((r2_ml(SMD_S_LMA_StandardDose$metaregression)[1]*100),1)`% |
|               Risk of Bias               |           \-            |                        \-                         |                                                    \-                                                    |         `r round((r2_ml(SMD_S_LMA_SyRCLERoBI)[1]*100),1)`%          |
|                    \-                    |    *0 criteria met*     |         `r SMD_S_LMA_SyRCLERoBI$beta[1]`          |                  `r SMD_S_LMA_SyRCLERoBI$ci.lb[1]` to `r SMD_S_LMA_SyRCLERoBI$ci.ub[1]`                  |                                 \-                                  |
|                    \-                    |    *1 criteria met*     |         `r SMD_S_LMA_SyRCLERoBI$beta[2]`          |                  `r SMD_S_LMA_SyRCLERoBI$ci.lb[2]` to `r SMD_S_LMA_SyRCLERoBI$ci.ub[2]`                  |                                 \-                                  |
|                    \-                    |    *2 criteria met*     |         `r SMD_S_LMA_SyRCLERoBI$beta[3]`          |                  `r SMD_S_LMA_SyRCLERoBI$ci.lb[3]` to `r SMD_S_LMA_SyRCLERoBI$ci.ub[3]`                  |                                 \-                                  |
|          Reporting completeness          |      per log unit       |     `r SMD_S_LMA_ARR2$metaregression$beta[2]`     |         `r SMD_S_LMA_ARR2$metaregression$ci.lb[2]` to `r SMD_S_LMA_ARR2$metaregression$ci.ub[2]`         |     `r round((r2_ml(SMD_S_LMA_ARR2$metaregression)[1]*100),1)`%     |

### 2.1.5 Sensitivity Analyses

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
options(scipen = 100, digits = 2)
```

We examine the robustness of the findings for the primary outcome by performing the following sensitivity analyses

#### Imputed 𝞺 values of 0.2 and 0.8

In the previous analyses for the effect of TAAR1 agonists on locomotor activity, we imputed a $\rho$ value - the imputed within-study correlation between observed effect sizes - of 0.5. Here, we examine the effect of imputing $\rho$ values of 0.2 and 0.8.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_rho0.2 <- run_ML_SMD(df, "TvC", "Locomotor activity", 0.2)
```

When the $\rho$ value is assumed to be 0.2, the TAAR1 interventions had a larger effect on locomotor activity of **SMD = `r SMD_S_LMA_rho0.2[["beta"]]`** (95% CI: `r SMD_S_LMA_rho0.2[["ci.lb"]]` to `r SMD_S_LMA_rho0.2[["ci.ub"]]`) with a prediction interval of `r predict(SMD_S_LMA_rho0.2)$pi.lb` to `r predict(SMD_S_LMA_rho0.2)$pi.ub`).

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_rho0.8 <- run_ML_SMD(df, "TvC", "Locomotor activity", 0.8)
```

When the $\rho$ value is assumed to be 0.8, the TAAR1 interventions had a smaller and more imprecise effect on locomotor activity of **SMD = `r SMD_S_LMA_rho0.8[["beta"]]`** (95% CI: `r SMD_S_LMA_rho0.8[["ci.lb"]]` to `r SMD_S_LMA_rho0.8[["ci.ub"]]`) with a prediction interval of `r predict(SMD_S_LMA_rho0.8)$pi.lb` to `r predict(SMD_S_LMA_rho0.8)$pi.ub`).

For reference the pooled effect size when rho is assumed to be 0.5 is `r SMD_S_LMA[["beta"]]` (95% CI: `r SMD_S_LMA[["ci.lb"]]` to `r SMD_S_LMA[["ci.ub"]]`). Therefore, the effect is very sensitive to imputed within-study correlation between effect sizes.

#### Normalised Mean Difference (NMD)

For locomotor activity, `r df_S_LMA %>% filter(NMD_possible == "TRUE") %>% nrow()` out of `r nrow(df_S_LMA)` comparisons, i.e. `r ((df_S_LMA %>% filter(NMD_possible == "TRUE") %>% nrow())/(nrow(df_S_LMA)))*100` % of comparisons, had data available for a Sham group and for these studies it was possible to calculate an NMD estimate of effect size.

The effect of administering a TAAR1 agonist on locomotor activity in animals using NMD as the effect size is shown in Figure 2.1.5. The pooled estimate for NMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
NMD_S_LMA <- run_ML_NMD(df, "TvC", "Locomotor activity", 0.5)
```

**Figure 2.1.5 - Forest plot of TAAR1 agonist vs control on locomotor activity using NMD**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=20, fig.width=12}
forest_metafor_NMD(NMD_S_LMA, "locomotor hyperactivity")
```

For TAAR1 Agonist v Control, TAAR1 interventions had a pooled effect on locomotor activity of NMD = `r NMD_S_LMA[["beta"]][1]` (95% CI: `r NMD_S_LMA[["ci.lb"]]` to `r NMD_S_LMA[["ci.ub"]]`) with a prediction interval of `r predict(NMD_S_LMA)$pi.lb` to `r predict(NMD_S_LMA)$pi.ub`). For reference the pooled effect size for SMD was `r SMD_S_LMA[["beta"]][1]` (95% CI: `r SMD_S_LMA[["ci.lb"]]` to `r SMD_S_LMA[["ci.ub"]]`).

`r NMD_S_LMA[["k"]]` experimental comparisons were reported in `r length(unique(NMD_S_LMA$data$ExperimentID_I))` experiments reported from `r length(unique(NMD_S_LMA$data$StudyId))` publications and involving `r length(unique(NMD_S_LMA$data$Strain))` different animal strains.

|            Level            |                                               Number of categories for that level included in this analysis                                               |                                                                   Attributable variance                                                                   |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% NMD_S_LMA$s.names, NMD_S_LMA$s.nlevels[[which(NMD_S_LMA$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% NMD_S_LMA$s.names, NMD_S_LMA$sigma2[[which(NMD_S_LMA$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% NMD_S_LMA$s.names, NMD_S_LMA$s.nlevels[[which(NMD_S_LMA$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% NMD_S_LMA$s.names, NMD_S_LMA$sigma2[[which(NMD_S_LMA$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% NMD_S_LMA$s.names, NMD_S_LMA$s.nlevels[[which(NMD_S_LMA$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% NMD_S_LMA$s.names, NMD_S_LMA$sigma2[[which(NMD_S_LMA$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

#### Robust variance estimator (RVE)

Here, we examine the robustness of results when using a sandwich-type estimator to obtain cluster-robust tests and confidence intervals of the model coefficients. The variance-covariance matrix is estimated using the 'bias-reduced linearization' for small-sample adjustment and Strain as a clustering variable.

```{r warning=FALSE, eval = TRUE, echo = FALSE}
SMD_S_LMA_RVE <- robust(SMD_S_LMA, cluster = Strain, clubSandwich=T, verbose=T)
```

When using the robust variance estimator, TAAR1 interventions had a pooled effect on locomotor activity of SMD = `r SMD_S_LMA_RVE[["beta"]][1]` (95% CI: `r SMD_S_LMA_RVE[["ci.lb"]]` to `r SMD_S_LMA_RVE[["ci.ub"]]` with a prediction interval of `r predict(SMD_S_LMA_RVE)$pi.lb` to `r predict(SMD_S_LMA_RVE)$pi.ub`). For reference the pooled effect size for SMD was `r SMD_S_LMA[["beta"]][1]` (95% CI: `r SMD_S_LMA[["ci.lb"]]` to `r SMD_S_LMA[["ci.ub"]]`), so the using a robust variance estimator does not substantially change the results.

### 2.1.6 Reporting bias/small-study effects

Because of the relationship between SMD effect sizes and variance inherent in their calculation, where study size is small the standard approach to seeking evidence of small-study effects (regression based tests including Egger's regression test for multilevel meta-analysis) can lead to over-estimation of small-study effect (see for instance 10.7554/eLife.24260). To address this we used Egger's regression test for multilevel meta-analysis, with regression of SMD effect size against 1/√N, where N is the total number of animals involved in an experiment.

```{r warning=FALSE, eval = TRUE, echo = FALSE}
run_sse_plot_SMD_L(df)
#run_sse_NMD(df)
```

Egger regression based on `r run_sse_SMD_L(df)[["k"]]` effects of TAAR1 Agonist v Control where Locomotor activity was measured showed a coefficient for small-study effect of `r run_sse_SMD_L(df)[["beta"]][2]` (95% CI: `r run_sse_SMD_L(df)[["ci.lb"]][2]` to `r run_sse_SMD_L(df)[["ci.ub"]][2]`; p = `r ifelse(run_sse_SMD_L(df)[["pval"]][2] < 0.001, "<0.001", sprintf("%.3f", run_sse_SMD_L(df)[["pval"]][2]))`).

|            Level            |                                                           Number of categories for that level included in this analysis                                                           |                                                                               Attributable variance                                                                               |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |                        `r ifelse('Strain' %in% run_sse_SMD_L(df)$s.names, run_sse_SMD_L(df)$s.nlevels[[which(run_sse_SMD_L(df)$s.names == 'Strain')]], 0)`                        |                         `r ifelse('Strain' %in% run_sse_SMD_L(df)$s.names, run_sse_SMD_L(df)$sigma2[[which(run_sse_SMD_L(df)$s.names == 'Strain')]], NA)`                         |
|       Study x Strain        |                `r ifelse('Strain/StudyId' %in% run_sse_SMD_L(df)$s.names, run_sse_SMD_L(df)$s.nlevels[[which(run_sse_SMD_L(df)$s.names == 'Strain/StudyId')]], 0)`                |                 `r ifelse('Strain/StudyId' %in% run_sse_SMD_L(df)$s.names, run_sse_SMD_L(df)$sigma2[[which(run_sse_SMD_L(df)$s.names == 'Strain/StudyId')]], NA)`                 |
| Study x Strain x Experiment | `r ifelse('Strain/StudyId/ExperimentID_I' %in% run_sse_SMD_L(df)$s.names, run_sse_SMD_L(df)$s.nlevels[[which(run_sse_SMD_L(df)$s.names == 'Strain/StudyId/ExperimentID_I')]], 0)` | `r ifelse('Strain/StudyId/ExperimentID_I' %in% run_sse_SMD_L(df)$s.names, run_sse_SMD_L(df)$sigma2[[which(run_sse_SMD_L(df)$s.names == 'Strain/StudyId/ExperimentID_I')]], 'NA')` |

## 2.2 Outcome 2: Cognitive function

### 2.2.1 Risks of bias

Figure 2.2.1 shows the risk of bias summary for studies investigating the effect of administering a TAAR1 agonist on cognition in animals. The risk of bias assessment was performed using the SyRCLE's RoB tool.

**Figure 2.2.1 - Traffic light plot of the risk of bias for cognitive function**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, height = 5}
SyRCLE_RoB_traffic(df, "TvC", "Cognition")
```

### 2.2.2 Reporting completeness

Figure 2.2.2 shows the reporting completeness summary for studies investigating the effect of administering a TAAR1 agonist on cognition in animals. The reporting completeness assessment was performed using the ARRIVE guidelines.

**Figure 2.2.2b - Traffic light plot of the reporting completeness for cognitive function**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height = 7}

ARRIVE_traffic(df, "TvC", "Cognition")
```

### 2.2.3 Meta-analysis

The effect of administering a TAAR1 agonist on cognitive outcomes in animals using SMD as the effect size is shown in Figure 2.2.3. The pooled estimate for SMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog <- run_ML_SMD(df, "TvC", "Cognition", 0.5)
if (any(class(SMD_S_Cog) == "rma.mv")) {
  output_text1 <- "Figure 2.2.3 - Forest plot of cognitive function for TAAR1 Agonist vs control"
} else {
  output_text1 <- ""
}
```

**`r output_text1`**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=7, fig.width=10}
forest_metafor(SMD_S_Cog, "TvC", "cognition")
```

```{r echo=FALSE}
if (any(class(SMD_S_Cog) == "rma.mv")) {
  output_text3 <- paste0("For TAAR1 Agonist v Control, TAAR1 interventions had a pooled effect on cognitive outcomes of SMD =", round(SMD_S_Cog[['beta']], 3), " (95% CI: ", round(SMD_S_Cog[['ci.lb']], 3), " to ", round(SMD_S_Cog[['ci.ub']], 3), ", with a prediction interval of", round(predict(SMD_S_Cog)$pi.lb, 3), " to ", round(predict(SMD_S_Cog)$pi.ub, 3),").")
} else {
  output_text3 <- "Analysis is only performed if outcomes have been reported in more than one publication. There are not sufficient data for this analysis."
}
```

`r output_text3`

`r SMD_S_Cog[["k"]]` experimental comparisons were reported in `r length(unique(SMD_S_Cog$data$ExperimentID_I))` experiments reported from `r length(unique(SMD_S_Cog$data$StudyId))` publications and involving `r length(unique(SMD_S_Cog$data$Strain))` different animal strains.

|            Level            |                                Number of categories for that level included in this analysis                                |                                                    Attributable variance                                                    |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog$s.names, SMD_S_Cog$s.nlevels[[which(SMD_S_Cog$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog$s.names, SMD_S_Cog$sigma2[[which(SMD_S_Cog$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog$s.names, SMD_S_Cog$s.nlevels[[which(SMD_S_Cog$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog$s.names, SMD_S_Cog$sigma2[[which(SMD_S_Cog$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog$s.names, SMD_S_Cog$s.nlevels[[which(SMD_S_Cog$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog$s.names, SMD_S_Cog$sigma2[[which(SMD_S_Cog$s.names == 'ExperimentID_I')]], 'NA')` |

### 2.2.4 Subgroup analyses and meta-regressions

#### Sex

Figure 2.2.4.1 displays the estimates for the pooled SMD's when comparisons are stratified by sex of the animal. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.2.4.1 - Subgroup analysis of TAAR1 agonist vs control on cognitive function by sex**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_Cog_sex <- subgroup_analysis(df, "TvC", "Cognition", "Sex", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
  forest_subgroup(SMD_S_Cog_sex$plotdata, "Sex", "Cognition","Sex")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_sex_noI <- subgroup_SMD(df, "TvC", "Cognition", "Sex", 0.5)
```

The p-value for the association between the sex of animal groups used and outcome reported was `r round(SMD_S_Cog_sex_noI$QMp,3)`.

|            Level            |                                                   Number of categories for that level included in this analysis                                                    |                                                                       Attributable variance                                                                        |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_sex$analysis$s.names, SMD_S_Cog_sex$analysis$s.nlevels[[which(SMD_S_Cog_sex$analysis$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_sex$analysis$s.names, SMD_S_Cog_sex$analysis$sigma2[[which(SMD_S_Cog_sex$analysis$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_sex$analysis$s.names, SMD_S_Cog_sex$analysis$s.nlevels[[which(SMD_S_Cog_sex$analysis$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_sex$analysis$s.names, SMD_S_Cog_sex$analysis$sigma2[[which(SMD_S_Cog_sex$analysis$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_sex$analysis$s.names, SMD_S_Cog_sex$analysis$s.nlevels[[which(SMD_S_Cog_sex$analysis$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_sex$analysis$s.names, SMD_S_Cog_sex$analysis$sigma2[[which(SMD_S_Cog_sex$analysis$s.names == 'ExperimentID_I')]], 'NA')` |

#### Category of disease induction

Figure 2.2.4.2 displays the estimates for the pooled SMD's when comparisons are stratified by the category of disease induction. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.2.4.2 - Subgroup analysis of TAAR1 agonist vs control on cognitive function by category of disease induction**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_Cog_CatDisInd <- subgroup_analysis(df, "TvC", "Cognition", "CategoryDiseaseInduction", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_Cog_CatDisInd$plotdata, "CategoryDiseaseInduction", "Cognition","Category of \nDisease Induction")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_CatDisInd_noI <- subgroup_SMD(df, "TvC", "Cognition", "CategoryDiseaseInduction", 0.5)
```

The p-value for the association between whether genetic or pharmacological models were used and outcome reported was `r round(SMD_S_Cog_CatDisInd_noI$QMp,3)`.

|            Level            |                                                            Number of categories for that level included in this analysis                                                             |                                                                                Attributable variance                                                                                 |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_CatDisInd$analysis$s.names, SMD_S_Cog_CatDisInd$analysis$s.nlevels[[which(SMD_S_Cog_CatDisInd$analysis$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_CatDisInd$analysis$s.names, SMD_S_Cog_CatDisInd$analysis$sigma2[[which(SMD_S_Cog_CatDisInd$analysis$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_CatDisInd$analysis$s.names, SMD_S_Cog_CatDisInd$analysis$s.nlevels[[which(SMD_S_Cog_CatDisInd$analysis$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_CatDisInd$analysis$s.names, SMD_S_Cog_CatDisInd$analysis$sigma2[[which(SMD_S_Cog_CatDisInd$analysis$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_CatDisInd$analysis$s.names, SMD_S_Cog_CatDisInd$analysis$s.nlevels[[which(SMD_S_Cog_CatDisInd$analysis$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_CatDisInd$analysis$s.names, SMD_S_Cog_CatDisInd$analysis$sigma2[[which(SMD_S_Cog_CatDisInd$analysis$s.names == 'ExperimentID_I')]], 'NA')` |

#### Route of intervention administration

Figure 2.2.4.3 displays the estimates for the pooled SMD's when comparisons are stratified by the administration route of the intervention. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.2.4.3 - Subgroup analysis of TAAR1 agonist vs control on cognitive function by route of intervention administration**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_Cog_AdminRoute <- subgroup_analysis(df, "TvC", "Cognition", "InterventionAdministrationRoute", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_Cog_AdminRoute$plotdata, "InterventionAdministrationRoute", "Cognition","Route of \nAdministration")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_AdminRoute_noI <- subgroup_SMD(df, "TvC", "Cognition", "InterventionAdministrationRoute", 0.5)
```

The p-value for the association between whether genetic or pharmacological models were used and outcome reported was `r round(SMD_S_Cog_AdminRoute_noI$QMp,3)`.

|            Level            |                                                              Number of categories for that level included in this analysis                                                              |                                                                                  Attributable variance                                                                                  |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_AdminRoute$analysis$s.names, SMD_S_Cog_AdminRoute$analysis$s.nlevels[[which(SMD_S_Cog_AdminRoute$analysis$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_AdminRoute$analysis$s.names, SMD_S_Cog_AdminRoute$analysis$sigma2[[which(SMD_S_Cog_AdminRoute$analysis$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_AdminRoute$analysis$s.names, SMD_S_Cog_AdminRoute$analysis$s.nlevels[[which(SMD_S_Cog_AdminRoute$analysis$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_AdminRoute$analysis$s.names, SMD_S_Cog_AdminRoute$analysis$sigma2[[which(SMD_S_Cog_AdminRoute$analysis$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_AdminRoute$analysis$s.names, SMD_S_Cog_AdminRoute$analysis$s.nlevels[[which(SMD_S_Cog_AdminRoute$analysis$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_AdminRoute$analysis$s.names, SMD_S_Cog_AdminRoute$analysis$sigma2[[which(SMD_S_Cog_AdminRoute$analysis$s.names == 'ExperimentID_I')]], 'NA')` |

#### Prophylactic or therapeutic intervention

In this iteration of the review, all relevant comparisons administered the TAAR1 agonist after induction of the disease model. Therefore, no subgroup analyses were conducted for this variable.

#### Duration of treatment period

In this iteration of the review, all relevant comparisons administered the TAAR1 agonist for \< 1 week. Therefore, no subgroup analyses were conducted for this variable.

#### The intervention administered

Figure 2.2.4.4 displays the estimates for the pooled SMD's when comparisons are stratified by the intervention administered. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.2.4.4 - Subgroup analysis of TAAR1 agonist vs control on cognitive function by intervention administered**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_Cog_Drug <- subgroup_analysis(df, "TvC", "Cognition", "DrugName", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_Cog_Drug$plotdata, "DrugName", "Cognition","Drug")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_Drug_noI <- subgroup_SMD(df, "TvC", "Cognition", "DrugName", 0.5)
```

The p-value for the association between the intervention and outcome reported was `r round(SMD_S_Cog_Drug_noI$QMp,3)`.

|            Level            |                                                     Number of categories for that level included in this analysis                                                     |                                                                         Attributable variance                                                                         |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_Drug$analysis$s.names, SMD_S_Cog_Drug$analysis$s.nlevels[[which(SMD_S_Cog_Drug$analysis$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_Drug$analysis$s.names, SMD_S_Cog_Drug$analysis$sigma2[[which(SMD_S_Cog_Drug$analysis$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_Drug$analysis$s.names, SMD_S_Cog_Drug$analysis$s.nlevels[[which(SMD_S_Cog_Drug$analysis$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_Drug$analysis$s.names, SMD_S_Cog_Drug$analysis$sigma2[[which(SMD_S_Cog_Drug$analysis$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_Drug$analysis$s.names, SMD_S_Cog_Drug$analysis$s.nlevels[[which(SMD_S_Cog_Drug$analysis$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_Drug$analysis$s.names, SMD_S_Cog_Drug$analysis$sigma2[[which(SMD_S_Cog_Drug$analysis$s.names == 'ExperimentID_I')]], 'NA')` |

#### The efficacy of the drug (i.e. whether the drug is a partial or full agonist)

In this iteration of the review, all relevant comparisons administered the TAAR1 agonists with partial agonist activity. Therefore, no subgroup analyses were conducted for this variable.

#### The selectivity of the drug

Figure 2.2.4.5 displays the estimates for the pooled SMD's when comparisons are stratified by the selectivity of the intervention administered. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.2.4.5 - Subgroup analysis of TAAR1 agonist vs control on cognitive function by selectivity of the drug**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_Cog_DrugSelectivity <- subgroup_analysis(df, "TvC", "Cognition", "Selectivity", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_Cog_DrugSelectivity$plotdata, "Selectivity", "Cognition","High or\nLow Selectivity")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_DrugSelectivity_noI <- subgroup_SMD(df, "TvC", "Cognition", "Selectivity", 0.5)
```

The p-value for the association between whether the drug was highly selective, or also manifests 5-HT1A effects, was `r round(SMD_S_Cog_DrugSelectivity_noI$QMp,3)`.

|            Level            |                                                                     Number of categories for that level included in this analysis                                                                      |                                                                                         Attributable variance                                                                                          |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_DrugSelectivity$analysis$s.names, SMD_S_Cog_DrugSelectivity$analysis$s.nlevels[[which(SMD_S_Cog_DrugSelectivity$analysis$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_DrugSelectivity$analysis$s.names, SMD_S_Cog_DrugSelectivity$analysis$sigma2[[which(SMD_S_Cog_DrugSelectivity$analysis$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_DrugSelectivity$analysis$s.names, SMD_S_Cog_DrugSelectivity$analysis$s.nlevels[[which(SMD_S_Cog_DrugSelectivity$analysis$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_DrugSelectivity$analysis$s.names, SMD_S_Cog_DrugSelectivity$analysis$sigma2[[which(SMD_S_Cog_DrugSelectivity$analysis$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_DrugSelectivity$analysis$s.names, SMD_S_Cog_DrugSelectivity$analysis$s.nlevels[[which(SMD_S_Cog_DrugSelectivity$analysis$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_DrugSelectivity$analysis$s.names, SMD_S_Cog_DrugSelectivity$analysis$sigma2[[which(SMD_S_Cog_DrugSelectivity$analysis$s.names == 'ExperimentID_I')]], 'NA')` |

#### Potency of interventions

The pEC50 value of each drug was used to measure potency. The pEC50 value is the negative logarithm (to base 10) of the EC50 value. Higher pEC50 values indicate higher potency (as they indicate a lower EC50). Figure 2.2.4.6 displays a visualisation of the meta-regression using the pEC50 value as an explanatory variable. Dashed lines represent the 95% confidence interval of the regression line. The dotted lines represent the 95% prediction interval. Raw data are plotted with 'bubble' size adjusted according to effect size precision.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}

SMD_S_Cog_potency <- metaregression_analysis(df, "TvC", "Cognition", "pE50", 0.5)

```

**Figure 2.2.4.6 - Meta-regression of TAAR1 agonist vs control on cognitive function by potency of the interventions**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE,}
SMD_S_Cog_potency$regression_plot
```

The estimate for $\beta$ was `r SMD_S_Cog_potency$metaregression_summary$beta[2]` (p = `r  round(SMD_S_Cog_potency$metaregression_summary$pval[2],3)`).

|            Level            |                                                                              Number of categories for that level included in this analysis                                                                               |                                                                                                  Attributable variance                                                                                                   |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_potency$metaregression_summary$s.names, SMD_S_Cog_potency$metaregression_summary$s.nlevels[[which(SMD_S_Cog_potency$metaregression_summary$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_potency$metaregression_summary$s.names, SMD_S_Cog_potency$metaregression_summary$sigma2[[which(SMD_S_Cog_potency$metaregression_summary$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_potency$metaregression_summary$s.names, SMD_S_Cog_potency$metaregression_summary$s.nlevels[[which(SMD_S_Cog_potency$metaregression_summary$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_potency$metaregression_summary$s.names, SMD_S_Cog_potency$metaregression_summary$sigma2[[which(SMD_S_Cog_potency$metaregression_summary$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_potency$metaregression_summary$s.names, SMD_S_Cog_potency$metaregression_summary$s.nlevels[[which(SMD_S_Cog_potency$metaregression_summary$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_potency$metaregression_summary$s.names, SMD_S_Cog_potency$metaregression_summary$sigma2[[which(SMD_S_Cog_potency$metaregression_summary$s.names == 'ExperimentID_I')]], 'NA')` |

#### Dose of intervention

In this iteration of the review, the TAAR1 agonists tested against control for their effect on cognition were; **`r drugs <- df %>% filter(SortLabel == "TvC") %>% filter(outcome_type == "Cognition") %>% group_by(DrugName) %>% summarise(count = n()) %>% arrange(desc(count)) %>% pull(DrugName); if (length(drugs) > 1) {paste(paste(head(drugs, -1), collapse = ", "), "and", tail(drugs, 1))} else {drugs}`**. Meta-analysis was conducted where data were available from more than nine experiments in more than two publications, and in this iteration of the review, no drugs met that threshold.

<!--# TO ADD IN METHODS SECTION: Meta-regression using the administered dose as an explanatory variable was conducted for each drug where this had been reported in 10 or more experiments from 3 or more publications. -->

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_RO5203648_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "RO5203648", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "RO5203648") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5203648: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_RO5203648_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "RO5203648")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_RO5263397_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "RO5263397", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "RO5263397") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5263397: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_RO5263397_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "RO5263397")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_SEP363856_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "SEP-363856", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "SEP-363856") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("SEP-363856 (Ultaront): There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_SEP363856_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "SEP-363856")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_RO5166017_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "RO5166017", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "RO5166017") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5166017: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_RO5166017_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "RO5166017")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_LK000764_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "LK000764", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "LK000764") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("LK000764: There were ", diag3 <- nrow(diag1), " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_LK000764_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "LK000764")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_RO5256390_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "RO5256390", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "RO5256390") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5256390: There were ", diag3 <- nrow(diag1), " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_RO5256390_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "RO5256390")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_Compound50B_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "Compound 50B", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "Compound 50B") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("Compound 50B: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_Compound50B_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "Compound 50B")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_Compound50A_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "Compound 50A", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "Compound 50A") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("Compound 50A: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_Compound50A_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "Compound 50A")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_RO5073012_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "RO5073012", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "RO5073012") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("RO5073012: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_RO5073012_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "RO5073012")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_AP163_dose <- metaregression_analysis_by_drug(df, "TvC", "Cognition", "AP163", "DoseOfIntervention_mgkg", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
diag1 <- df %>%
filter(SortLabel == "TvC") %>%
filter(outcome_type == "Cognition") %>%
filter(DrugName == "AP163") %>%
filter(!is.na(SMDv)) %>%
filter(!is.na(!!sym("DoseOfIntervention_mgkg")))
diag2 <- n_distinct(diag1$StudyId)
diag3 <- nrow(diag1)

output_text0 <- paste0("AP163: There were ", diag3, " comparisons from ", diag2, " publication(s).")

```

`r output_text0`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
   metaregression_plot_by_drug(SMD_S_Cog_AP163_dose, df, "TvC", "Cognition","DoseOfIntervention_mgkg", "AP163")
```

##### Standardised dose

We then sought evidence of a dose response relationship across all drugs using the approach described for locomotor activity.

Figure 2.2.4.7 provides a visualisation of the meta-regression analysis relationship between standardised doses of TAAR1 agonists and the Standardized Mean Difference (SMD) change in cognition. As before, dashed lines represent the 95% confidence interval of the regression line and dotted lines represent the 95% prediction interval. Raw data are plotted with point size adjusted according to effect size precision.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}

SMD_S_Cog_StandardDose <- metaregression_analysis(df, "TvC", "Cognition", "StandardisedDose", 0.5)

```

**Figure 2.2.4.7 - Meta regression of standardised dose for TAAR1 agonist vs control on cognitive function**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE,}
SMD_S_Cog_StandardDose$regression_plot
```

The estimate for the change in effect per log unit change in standardised dose was `r SMD_S_Cog_StandardDose$metaregression_summary$beta[2]` (p `r if(round(SMD_S_Cog_StandardDose[["metaregression"]][["pval"]][2],3)>0.001){paste0('= ',round(SMD_S_Cog_StandardDose[["metaregression"]][["pval"]][2],3))}else{'< 0.001'}`).

|            Level            |                                                                          Number of categories for that level included in this analysis                                                                          |                                                                                              Attributable variance                                                                                              |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_StandardDose$metaregression$s.names, SMD_S_Cog_StandardDose$metaregression$s.nlevels[[which(SMD_S_Cog_StandardDose$metaregression$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_StandardDose$metaregression$s.names, SMD_S_Cog_StandardDose$metaregression$sigma2[[which(SMD_S_Cog_StandardDose$metaregression$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_StandardDose$metaregression$s.names, SMD_S_Cog_StandardDose$metaregression$s.nlevels[[which(SMD_S_Cog_StandardDose$metaregression$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_StandardDose$metaregression$s.names, SMD_S_Cog_StandardDose$metaregression$sigma2[[which(SMD_S_Cog_StandardDose$metaregression$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_StandardDose$metaregression$s.names, SMD_S_Cog_StandardDose$metaregression$s.nlevels[[which(SMD_S_Cog_StandardDose$metaregression$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_StandardDose$metaregression$s.names, SMD_S_Cog_StandardDose$metaregression$sigma2[[which(SMD_S_Cog_StandardDose$metaregression$s.names == 'ExperimentID_I')]], 'NA')` |

#### SyRCLE RoB assessment considered as a categorical variable

Figure 2.2.4.8 displays the estimates for the pooled SMD's when comparisons are stratified by how many of the SyRCLE risk of bias assessment criteria (of which there are 10) that the experiment met. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.2.4.8 - Subgroup analysis of TAAR1 agonist vs control on cognitive function by SyRCLE RoB criteria met**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_Cog_SyRCLERoB <- subgroup_analysis(df, "TvC", "Cognition", "RoBScore", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_Cog_SyRCLERoB$plotdata, "RoBScore", "Cognition","SyRCLE RoB score")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_SyRCLERoB_noI <- subgroup_SMD(df, "TvC", "Cognition", "RoBScore", 0.5)
```

The p-value for the association between SyRCLE Risks of Bias reporting and outcome reported was `r round(SMD_S_Cog_SyRCLERoB_noI$QMp,3)`.

|            Level            |                                                            Number of categories for that level included in this analysis                                                             |                                                                                Attributable variance                                                                                 |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_Cog_SyRCLERoB$analysis$s.names, SMD_S_Cog_SyRCLERoB$analysis$s.nlevels[[which(SMD_S_Cog_SyRCLERoB$analysis$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_Cog_SyRCLERoB$analysis$s.names, SMD_S_Cog_SyRCLERoB$analysis$sigma2[[which(SMD_S_Cog_SyRCLERoB$analysis$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_Cog_SyRCLERoB$analysis$s.names, SMD_S_Cog_SyRCLERoB$analysis$s.nlevels[[which(SMD_S_Cog_SyRCLERoB$analysis$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_Cog_SyRCLERoB$analysis$s.names, SMD_S_Cog_SyRCLERoB$analysis$sigma2[[which(SMD_S_Cog_SyRCLERoB$analysis$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_SyRCLERoB$analysis$s.names, SMD_S_Cog_SyRCLERoB$analysis$s.nlevels[[which(SMD_S_Cog_SyRCLERoB$analysis$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_Cog_SyRCLERoB$analysis$s.names, SMD_S_Cog_SyRCLERoB$analysis$sigma2[[which(SMD_S_Cog_SyRCLERoB$analysis$s.names == 'ExperimentID_I')]], 'NA')` |

#### SyRCLE RoB assessment considering those studies where any item is at low risk of bias

Figure 2.2.4.9 displays the estimates for the pooled SMD's when comparisons are stratified by whether of not any of the SyRCLE Risk of bias domains were rated as low risk of bias. Whiskers indicate the 95% confidence interval of each estimate. The overall pooled SMD is displayed as a diamond shape at the bottom of the plot.

**Figure 2.2.4.9 - Subgroup analysis of TAAR1 agonist vs control on cognitive function by alternative SyRCLE RoB assessment**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_cog_SyRCLERoBTF <- subgroup_analysis(df, "TvC", "Cognition", "RoBTF", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
forest_subgroup(SMD_S_cog_SyRCLERoBTF$plotdata, "RoBTF", "Cognition","RoB score")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_cog_SyRCLERoBTF_noI <- subgroup_SMD(df, "TvC", "Cognition", "RoBTF", 0.5)
```

The p-value for the association between low SyRCLE Risks of Bias reporting and outcome reported was `r round(SMD_S_cog_SyRCLERoBTF_noI$QMp,3)`.

|            Level            |                                                               Number of categories for that level included in this analysis                                                                |                                                                                   Attributable variance                                                                                    |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_cog_SyRCLERoBTF$analysis$s.names, SMD_S_cog_SyRCLERoBTF$analysis$s.nlevels[[which(SMD_S_cog_SyRCLERoBTF$analysis$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_cog_SyRCLERoBTF$analysis$s.names, SMD_S_cog_SyRCLERoBTF$analysis$sigma2[[which(SMD_S_cog_SyRCLERoBTF$analysis$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_cog_SyRCLERoBTF$analysis$s.names, SMD_S_cog_SyRCLERoBTF$analysis$s.nlevels[[which(SMD_S_cog_SyRCLERoBTF$analysis$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_cog_SyRCLERoBTF$analysis$s.names, SMD_S_cog_SyRCLERoBTF$analysis$sigma2[[which(SMD_S_cog_SyRCLERoBTF$analysis$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_cog_SyRCLERoBTF$analysis$s.names, SMD_S_cog_SyRCLERoBTF$analysis$s.nlevels[[which(SMD_S_cog_SyRCLERoBTF$analysis$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_cog_SyRCLERoBTF$analysis$s.names, SMD_S_cog_SyRCLERoBTF$analysis$sigma2[[which(SMD_S_cog_SyRCLERoBTF$analysis$s.names == 'ExperimentID_I')]], 'NA')` |

#### ARRIVE reporting completeness guidelines

Figure 2.2.4.10 displays a visualisation of the meta-regression using the number of ARRIVE items met (from a possible total of 22) as an explanatory variable. Dashed lines represent the 95% confidence interval of the regression line. The dotted lines represent the 95% prediction interval. Raw data are plotted with 'bubble' size adjusted according to effect size precision.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_cog_ARR2 <- metaregression_analysis(df, "TvC", "Cognition", "ARRIVEScore", 0.5)

```

**Figure 2.2.4.10 - Meta-regression of number of ARRIVE items met for TAAR1 agonist vs control on cognitive function**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE,}
SMD_S_cog_ARR2$regression_plot
```

The estimate for $\beta$ was `r SMD_S_cog_ARR2$metaregression_summary$beta[2]` (p = `r  round(SMD_S_cog_ARR2$metaregression_summary$pval[2],3)`).

|            Level            |                                                              Number of categories for that level included in this analysis                                                              |                                                                                  Attributable variance                                                                                  |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_cog_ARR2$metaregression$s.names, SMD_S_cog_ARR2$metaregression$s.nlevels[[which(SMD_S_cog_ARR2$metaregression$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_cog_ARR2$metaregression$s.names, SMD_S_cog_ARR2$metaregression$sigma2[[which(SMD_S_cog_ARR2$metaregression$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_cog_ARR2$metaregression$s.names, SMD_S_cog_ARR2$metaregression$s.nlevels[[which(SMD_S_cog_ARR2$metaregression$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_cog_ARR2$metaregression$s.names, SMD_S_cog_ARR2$metaregression$sigma2[[which(SMD_S_cog_ARR2$metaregression$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_cog_ARR2$metaregression$s.names, SMD_S_cog_ARR2$metaregression$s.nlevels[[which(SMD_S_cog_ARR2$metaregression$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_cog_ARR2$metaregression$s.names, SMD_S_cog_ARR2$metaregression$sigma2[[which(SMD_S_cog_ARR2$metaregression$s.names == 'ExperimentID_I')]], 'NA')` |

#### Heterogeneity explained by covariates (TAAR1 Agonist vs Control on cognitive function)

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide', out.width = "100%"}
SMD_S_Cog_sexI <- subgroup_SMDI(df, "TvC", "Cognition", "Sex", 0.5)
SMD_S_Cog_CatDisIndI <- subgroup_SMDI(df, "TvC", "Cognition", "CategoryDiseaseInduction", 0.5)
SMD_S_Cog_AdminRouteI <- subgroup_SMDI(df, "TvC", "Cognition", "InterventionAdministrationRoute", 0.5)
SMD_S_Cog_ProphTheraI <- subgroup_SMDI(df, "TvC", "Cognition", "ProphylacticOrTherapeutic", 0.5)
SMD_S_Cog_DurRxI <- subgroup_SMDI(df, "TvC", "Cognition", "TreatmentDurationCategory", 0.5)
SMD_S_Cog_DrugI <- subgroup_SMDI(df, "TvC", "Cognition", "DrugName", 0.5)
SMD_S_Cog_SyRCLERoBI <- subgroup_SMDI(df, "TvC", "Cognition", "RoBScore", 0.5)
SMD_S_Cog_ARRIVEI <- subgroup_SMDI(df, "TvC", "Cognition", "ARRIVEScoreCat", 0.5)
SMD_S_Cog_DrugSelectivityI <- subgroup_SMDI(df, "TvC", "Cognition", "Selectivity", 0.5)
```

The table below summarises the heterogeneity observed for each covariate in the effect sizes of the effect of TAAR1 agonists on locomotor activity. We present marginal R^2^ (the % change in the between-studies variance when the covariate is included in the model), which measures the proportion of variance explained by including moderators in the model . The coefficients are derived from an rma model fitted with an intercept (and so represent, for each category, the point estimate and 95% CIs of the effect in that category).

|              Moderator              |        Category         |                      $\beta$                      |                                                  95% CI                                                  |                          Marginal R^2^ (%)                          |
|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
|           Overall effect            |           \-            |               `r SMD_S_Cog$beta[1]`               |                                `r SMD_S_Cog$ci.lb` to `r SMD_S_Cog$ci.ub`                                |                                 \-                                  |
|                 Sex                 |           \-            |                        \-                         |                                                    \-                                                    |            `r round((r2_ml(SMD_S_Cog_sexI)[1]*100),1)`%             |
|                 \-                  |        *Female*         |            `r SMD_S_Cog_sexI$beta[1]`             |                        `r SMD_S_Cog_sexI$ci.lb[1]` to `r SMD_S_Cog_sexI$ci.ub[1]`                        |                                 \-                                  |
|                 \-                  |         *Male*          |            `r SMD_S_Cog_sexI$beta[2]`             |                        `r SMD_S_Cog_sexI$ci.lb[2]` to `r SMD_S_Cog_sexI$ci.ub[2]`                        |                                 \-                                  |
|                 \-                  | *Mixed male and female* |            `r SMD_S_Cog_sexI$beta[3]`             |                        `r SMD_S_Cog_sexI$ci.lb[3]` to `r SMD_S_Cog_sexI$ci.ub[3]`                        |                                 \-                                  |
| Category of disease model induction |           \-            |                        \-                         |                                                    \-                                                    |         `r round((r2_ml(SMD_S_Cog_CatDisIndI)[1]*100),1)`%          |
|                 \-                  |        *Genetic*        |         `r SMD_S_Cog_CatDisIndI$beta[1]`          |                  `r SMD_S_Cog_CatDisIndI$ci.lb[1]` to `r SMD_S_Cog_CatDisIndI$ci.ub[1]`                  |                                 \-                                  |
|                 \-                  |    *Pharmacological*    |         `r SMD_S_Cog_CatDisIndI$beta[2]`          |                  `r SMD_S_Cog_CatDisIndI$ci.lb[2]` to `r SMD_S_Cog_CatDisIndI$ci.ub[2]`                  |                                 \-                                  |
|        Administration route         |           \-            |                        \-                         |                                                    \-                                                    |         `r round((r2_ml(SMD_S_Cog_AdminRouteI)[1]*100),1)`%         |
|                 \-                  |    *Intraperitoneal*    |         `r SMD_S_Cog_AdminRouteI$beta[1]`         |                 `r SMD_S_Cog_AdminRouteI$ci.lb[1]` to `r SMD_S_Cog_AdminRouteI$ci.ub[1]`                 |                                 \-                                  |
|                 \-                  |         *Oral*          |         `r SMD_S_Cog_AdminRouteI$beta[2]`         |                 `r SMD_S_Cog_AdminRouteI$ci.lb[2]` to `r SMD_S_Cog_AdminRouteI$ci.ub[2]`                 |                                 \-                                  |
|      Intervention administered      |           \-            |                        \-                         |                                                    \-                                                    |            `r round((r2_ml(SMD_S_Cog_DrugI)[1]*100),1)`%            |
|                 \-                  |       *RO5203648*       |            `r SMD_S_Cog_DrugI$beta[1]`            |                       `r SMD_S_Cog_DrugI$ci.lb[1]` to `r SMD_S_Cog_DrugI$ci.ub[1]`                       |                                 \-                                  |
|                 \-                  |       *RO5256390*       |            `r SMD_S_Cog_DrugI$beta[2]`            |                       `r SMD_S_Cog_DrugI$ci.lb[2]` to `r SMD_S_Cog_DrugI$ci.ub[2]`                       |                                 \-                                  |
|                 \-                  | *SEP-363856 (Ultaront)* |            `r SMD_S_Cog_DrugI$beta[3]`            |                       `r SMD_S_Cog_DrugI$ci.lb[3]` to `r SMD_S_Cog_DrugI$ci.ub[3]`                       |                                 \-                                  |
|          Drug selectivity           |           \-            |                        \-                         |                                                    \-                                                    |      `r round((r2_ml(SMD_S_Cog_DrugSelectivityI)[1]*100),1)`%       |
|                 \-                  |         *High*          |      `r SMD_S_Cog_DrugSelectivityI$beta[1]`       |            `r SMD_S_Cog_DrugSelectivityI$ci.lb[1]` to `r SMD_S_Cog_DrugSelectivityI$ci.ub[1]`            |                                 \-                                  |
|                 \-                  |          *Low*          |      `r SMD_S_Cog_DrugSelectivityI$beta[2]`       |            `r SMD_S_Cog_DrugSelectivityI$ci.lb[2]` to `r SMD_S_Cog_DrugSelectivityI$ci.ub[2]`            |                                 \-                                  |
|            Drug potency             |      per log unit       |   `r SMD_S_Cog_potency$metaregression$beta[2]`    |      `r SMD_S_Cog_potency$metaregression$ci.lb[2]` to `r SMD_S_Cog_potency$metaregression$ci.ub[2]`      |   `r round((r2_ml(SMD_S_Cog_potency$metaregression)[1]*100),1)`%    |
|          Standardised dose          |      per log unit       | `r SMD_S_Cog_StandardDose$metaregression$beta[2]` | `r SMD_S_Cog_StandardDose$metaregression$ci.lb[2]` to `r SMD_S_Cog_StandardDose$metaregression$ci.ub[2]` | `r round((r2_ml(SMD_S_Cog_StandardDose$metaregression)[1]*100),1)`% |
|            Risk of Bias             |           \-            |                        \-                         |                                                    \-                                                    |         `r round((r2_ml(SMD_S_Cog_SyRCLERoBI)[1]*100),1)`%          |
|                 \-                  |    *0 criteria met*     |         `r SMD_S_Cog_SyRCLERoBI$beta[1]`          |                  `r SMD_S_Cog_SyRCLERoBI$ci.lb[1]` to `r SMD_S_Cog_SyRCLERoBI$ci.ub[1]`                  |                                 \-                                  |
|                 \-                  |    *1 criteria met*     |         `r SMD_S_Cog_SyRCLERoBI$beta[2]`          |                  `r SMD_S_Cog_SyRCLERoBI$ci.lb[2]` to `r SMD_S_Cog_SyRCLERoBI$ci.ub[2]`                  |                                 \-                                  |
|       Reporting completeness        |      per log unit       |     `r SMD_S_cog_ARR2$metaregression$beta[2]`     |         `r SMD_S_cog_ARR2$metaregression$ci.lb[2]` to `r SMD_S_cog_ARR2$metaregression$ci.ub[2]`         |     `r round((r2_ml(SMD_S_cog_ARR2$metaregression)[1]*100),1)`%     |

### 2.2.5. Sensitivity Analyses

#### Imputed 𝞺 values of 0.2 and 0.8

In the previous analyses for the effect of TAAR1 agonists on cognition, we imputed a $\rho$ value of 0.5. Here, we examine the effect of imputing $\rho$ values of 0.2 and 0.8.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_rho0.2 <- run_ML_SMD(df, "TvC", "Cognition", 0.2)
```

When the $\rho$ value is assumed to be 0.2, the TAAR1 interventions had a pooled effect on cognition of **SMD = `r SMD_S_Cog_rho0.2[["beta"]]`** (95% CI: `r SMD_S_Cog_rho0.2[["ci.lb"]]` to `r SMD_S_Cog_rho0.2[["ci.ub"]]`) with a prediction interval of `r predict(SMD_S_Cog_rho0.2)$pi.lb` to `r predict(SMD_S_Cog_rho0.2)$pi.ub`).

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_Cog_rho0.8 <- run_ML_SMD(df, "TvC", "Cognition", 0.8)
```

When the $\rho$ value is assumed to be 0.8, the TAAR1 interventions had a pooled effect on cognition of **SMD = `r SMD_S_Cog_rho0.8[["beta"]]`** (95% CI: `r SMD_S_Cog_rho0.8[["ci.lb"]]` to `r SMD_S_Cog_rho0.8[["ci.ub"]]`) with a prediction interval of `r predict(SMD_S_Cog_rho0.8)$pi.lb` to `r predict(SMD_S_Cog_rho0.8)$pi.ub`).

For reference the pooled effect size when rho is assumed to be 0.5 is `r SMD_S_Cog[["beta"]]` (95% CI: `r SMD_S_Cog[["ci.lb"]]` to `r SMD_S_Cog[["ci.ub"]]`).

#### Normalised Mean Difference (NMD)

For cognition, `r df_S_cog %>% filter(NMD_possible == "TRUE") %>% nrow()` out of `r nrow(df_S_cog)` comparisons, i.e. `r ((df_S_cog %>% filter(NMD_possible == "TRUE") %>% nrow())/(nrow(df_S_cog)))*100` % of comparisons, had data available for a Sham group, and for these studies it was possible to calculate an NMD estimate of effect size.

The effect of administering a TAAR1 agonist on cognition in animals using NMD as the effect size is shown in Figure 2.2.5. The pooled estimate for NMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate.

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
NMD_S_cog <- run_ML_NMD(df, "TvC", "Cognition", 0.5)
```

**Figure 2.2.5 - Forest plot of TAAR1 agonist vs control on cognitive function using NMD**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=9, fig.width=11}
forest_metafor_NMD(NMD_S_cog, "Cognition")
```

For TAAR1 Agonist v Control, TAAR1 interventions had a pooled effect on cognition of NMD = `r NMD_S_cog[["beta"]][1]` (95% CI: `r NMD_S_cog[["ci.lb"]]` to `r NMD_S_cog[["ci.ub"]]`) with a prediction interval of `r predict(NMD_S_cog)$pi.lb` to `r predict(NMD_S_cog)$pi.ub`. For reference the pooled effect size for SMD was `r SMD_S_Cog[["beta"]]` (95% CI: `r SMD_S_Cog[["ci.lb"]]` to `r SMD_S_Cog[["ci.ub"]]`).

`r NMD_S_cog[["k"]]` experimental comparisons were reported in `r length(unique(NMD_S_cog$data$ExperimentID_I))` experiments reported from `r length(unique(NMD_S_cog$data$StudyId))` publications and involving `r length(unique(NMD_S_cog$data$Strain))` different animal strains.

|            Level            |                                Number of categories for that level included in this analysis                                |                                                    Attributable variance                                                    |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% NMD_S_cog$s.names, NMD_S_cog$s.nlevels[[which(NMD_S_cog$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% NMD_S_cog$s.names, NMD_S_cog$sigma2[[which(NMD_S_cog$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% NMD_S_cog$s.names, NMD_S_cog$s.nlevels[[which(NMD_S_cog$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% NMD_S_cog$s.names, NMD_S_cog$sigma2[[which(NMD_S_cog$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% NMD_S_cog$s.names, NMD_S_cog$s.nlevels[[which(NMD_S_cog$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% NMD_S_cog$s.names, NMD_S_cog$sigma2[[which(NMD_S_cog$s.names == 'ExperimentID_I')]], 'NA')` |

#### Robust variance estimator (RVE)

Here, we examine the robustness of results when using a sandwich-type estimator to obtain cluster-robust tests and confidence intervals of the model coefficients. The variance-covariance matrix is estimated using the 'bias-reduced linearization' for small-sample adjustment and Strain as a clustering variable.

```{r warning=FALSE, eval = TRUE, echo = FALSE}
SMD_S_Cog_RVE <- robust(SMD_S_Cog, cluster = Strain, clubSandwich=T, verbose=T)
```

When using the robust variance estimator, TAAR1 interventions had a pooled effect on cognition of SMD = `r SMD_S_Cog_RVE[["beta"]][1]` (95% CI: `r SMD_S_Cog_RVE[["ci.lb"]]` to `r SMD_S_Cog_RVE[["ci.ub"]]` with a prediction interval of `r predict(SMD_S_Cog_RVE)$pi.lb` to `r predict(SMD_S_Cog_RVE)$pi.ub`). For reference the pooled effect size for SMD was `r SMD_S_Cog[["beta"]]` (95% CI: `r SMD_S_Cog[["ci.lb"]]` to `r SMD_S_Cog[["ci.ub"]]`), so the using a robust variance estimator does not substantially change the results.

### 2.2.6 Reporting bias/small-study effects

Because of the relationship between SMD effect sizes and variance inherent in their calculation, where study size is small the standard approach to seeking evidence of small-study effects (regression based tests including Egger's regression test for multilevel meta-analysis) can lead to over-estimation of small-study effect (see for instance 10.7554/eLife.24260). To address this we used Egger's regression test for multilevel meta-analysis, with regression of SMD effect size against 1/√N, where N is the total number of animals involved in an experiment.

```{r warning=FALSE, eval = TRUE, echo = FALSE}
run_sse_plot_SMD_C(df)
#run_sse_NMD(df)
```

Egger regression based on `r run_sse_SMD_C(df)[["k"]]` effects of TAAR1 Agonist v Control where Locomotor activity was measured showed a coefficient for a small study effect of `r run_sse_SMD_C(df)[["beta"]][2]` (95% CI: `r run_sse_SMD_C(df)[["ci.lb"]][2]` to `r run_sse_SMD_C(df)[["ci.ub"]][2]`; p = `r ifelse(run_sse_SMD_C(df)[["pval"]][2] < 0.001, "<0.001", sprintf("%.3f", run_sse_SMD_C(df)[["pval"]][2]))`).

|            Level            |                                            Number of categories for that level included in this analysis                                            |                                                                Attributable variance                                                                |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% run_sse_SMD_C(df)$s.names, run_sse_SMD_C(df)$s.nlevels[[which(run_sse_SMD_C(df)$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% run_sse_SMD_C(df)$s.names, run_sse_SMD_C(df)$sigma2[[which(run_sse_SMD_C(df)$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% run_sse_SMD_C(df)$s.names, run_sse_SMD_C(df)$s.nlevels[[which(run_sse_SMD_C(df)$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% run_sse_SMD_C(df)$s.names, run_sse_SMD_C(df)$sigma2[[which(run_sse_SMD_C(df)$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% run_sse_SMD_C(df)$s.names, run_sse_SMD_C(df)$s.nlevels[[which(run_sse_SMD_C(df)$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% run_sse_SMD_C(df)$s.names, run_sse_SMD_C(df)$sigma2[[which(run_sse_SMD_C(df)$s.names == 'ExperimentID_I')]], 'NA')` |

# 3 TAAR1 Agonist v known antipsychotic drug

## 3.1 Outcome 1: Locomotor activity

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_H2H <- run_ML_SMD(df, "TvA", "Locomotor activity", 0.5)
```

```{r echo=FALSE}
 if (any(class(SMD_S_LMA_H2H) == "rma.mv")) {
  output_text1 <- "In TAAR1 Agonist v known antipsychotic drug studies, the effect of administering a TAAR1 agonist on Locomotor activity in animals using SMD as the effect size is shown in Figure 3.1. The pooled estimate for SMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate."
  output_text2 <- "Figure 3.1 - Forest plot of Locomotor activity for TAAR1 Agonist vs known antipychotic drug"
} else {
  output_text1 <- "Multilevel analysis is only performed if there are 5 levels or more for at least one of Strain, Study and Experiment, and that is not the case here."
  output_text2 <- ""
}
```

`r output_text1`

**`r output_text2`**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=9, fig.width=12}
forest_metafor(SMD_S_LMA_H2H, "TvA", "locomotor activity")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=9, fig.width=12}
 if (!any(class(SMD_S_LMA_H2H) == "rma.mv")) {
   forest_metafor(SMD_LMA_H2H, "TvA","Locomotor activity")}
```

```{r echo=FALSE}
 if (any(class(SMD_S_LMA_H2H) == "rma.mv")) {
  output_text3 <- paste0("For TAAR1 Agonist v known antipsychotic drug comparisons, TAAR1 interventions had a pooled effect on locomotor activity of SMD =", round(SMD_S_LMA_H2H[['beta']], 3), " (95% CI: ", round(SMD_S_LMA_H2H[['ci.lb']], 3), " to ", round(SMD_S_LMA_H2H[['ci.ub']], 3), ", with a prediction interval of", round(predict(SMD_S_LMA_H2H)$pi.lb, 3), " to ", round(predict(SMD_S_LMA_H2H)$pi.ub, 3), ").")
} else {
  output_text3 <- ""
}
```

`r output_text3`

`r SMD_S_LMA_H2H[["k"]]` experimental comparisons were reported in `r length(unique(SMD_S_LMA_H2H$data$ExperimentID_I))` experiments reported from `r  length(unique(SMD_S_LMA_H2H$data$StudyId))` publications and involving `r length(unique(SMD_S_LMA_H2H$data$Strain))` different animal strains.

|            Level            |                                      Number of categories for that level included in this analysis                                      |                                                          Attributable variance                                                          |
|:----------------------:|:----------------------:|:----------------------:|
|           Strain            |         `r ifelse('Strain' %in% SMD_S_LMA_H2H$s.names, SMD_S_LMA_H2H$s.nlevels[[which(SMD_S_LMA_H2H$s.names == 'Strain')]], 0)`         |          `r ifelse('Strain' %in% SMD_S_LMA_H2H$s.names, SMD_S_LMA_H2H$sigma2[[which(SMD_S_LMA_H2H$s.names == 'Strain')]], NA)`          |
|       Study x Strain        | `r ifelse('Strain/StudyId' %in% SMD_S_LMA_H2H$s.names, SMD_S_LMA_H2H$s.nlevels[[which(SMD_S_LMA_H2H$s.names == 'Strain/StudyId')]], 0)` |  `r ifelse('Strain/StudyId' %in% SMD_S_LMA_H2H$s.names, SMD_S_LMA_H2H$sigma2[[which(SMD_S_LMA_H2H$s.names == 'Strain/StudyId')]], NA)`  |
| Study x Strain x Experiment | `r ifelse('ExperimentID_I' %in% SMD_S_LMA_H2H$s.names, SMD_S_LMA_H2H$s.nlevels[[which(SMD_S_LMA_H2H$s.names == 'ExperimentID_I')]], 0)` | `r ifelse('ExperimentID_I' %in% SMD_S_LMA_H2H$s.names, SMD_S_LMA_H2H$sigma2[[which(SMD_S_LMA_H2H$s.names == 'ExperimentID_I')]], 'NA')` |

## 3.2 Outcome 2: Cognitive function

Only one study reported cognitive outcomes in this category, so meta-analysis was not performed.

# 4 Co-treatment with TAAR1 agonist plus known antipsychotic drug v known antipsychotic drug alone

## 4.1 Outcome 1: Locomotor activity

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_TAA <- run_ML_SMD(df, "TAvA", "Locomotor activity", 0.5)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_LMA_TAA <- run_SMD(df, "TAvA", "Locomotor activity")
```

```{r echo=FALSE}
 if (any(class(SMD_S_LMA_TAA) == "rma.mv")) {
  output_text1 <- "For combination studies, the effect of administering a TAAR1 agonist plus a conventional antipsychotic drug, compared with TAAR1 agonist alone, on locomotor activity in animals using SMD as the effect size is shown in Figure 4.1. The pooled estimate for SMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate."
  output_text2 <- "Figure 4.1 - Forest plot of Locomotor activity for TAAR1 Agonist + known antipsychotic vs known antipychotic alone"
} else {
  output_text1 <- "Multilevel analysis is only performed if there are 5 levels or more for at least one of Strain, Study and Experiment, and that is not the case here. We provide a conventional univariate random effects model to illustrate the data"
  output_text2 <- ""
}
```

`r output_text1`

**`r output_text2`**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=9, fig.width=12}
forest_metafor(SMD_S_LMA_TAA, "TAvA","Locomotor activity")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=9, fig.width=12}
 if (!any(class(SMD_S_LMA_TAA) == "rma.mv")) {
   forest_metafor(SMD_LMA_TAA, "TAvA","Locomotor activity")}
```

```{r echo = FALSE}
# Check if the object is NULL
 if (any(class(SMD_S_LMA_TAA) == "rma.mv")) {
  output_text3 <- paste0("For combination experiments, TAAR1 agonists with antipsychotic drugs, compared with antipsychotic drugs alone, had a pooled effect on locomotor activity of SMD =", round(SMD_S_LMA_TAA[['beta']], 3), " (95% CI: ", round(SMD_S_LMA_TAA[['ci.lb']], 3), " to ", round(SMD_S_LMA_TAA[['ci.ub']], 3),", with a prediction interval of ", round(predict(SMD_S_LMA_TAA)$pi.lb, 3), " to ", round(predict(SMD_S_LMA_TAA)$pi.ub, 3), ").")
  output_text4 <- paste0(`r SMD_S_LMA_TAA$k`," experimental comparisons were reported in ",`r SMD_S_LMA_TAA$s.nlevels[3]`," experiments reported from ",`r SMD_S_LMA_TAA$s.nlevels[2]`," publications and involving ",`r SMD_S_LMA_TAA$s.nlevels[1]`," different animal strains. The between strain variance was ",`r SMD_S_LMA_TAA$sigma2[1]`,", the between study variance ",`r SMD_S_LMA_TAA$sigma2[2]`," and the within-experiment variance ",`r SMD_S_LMA_TAA$sigma2[3]`,".")
} else {
  output_text3 <- ""
}

```

`r output_text3`

## 4.2 Outcome 2: Cognitive function

Only one study reported cognitive outcomes in this category, so meta-analysis was not performed.

# 5 Effect of TAAR1 agonists in TAAR1 receptor knockout animals

## 5.1 Outcome 1: Locomotor activity

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_S_LMA_KO <- run_ML_SMD(df, "TvC_KO","Locomotor activity",0.5 )
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, results='hide'}
SMD_LMA_KO <- run_SMD(df, "TvC_KO","Locomotor activity")
```

```{r echo=FALSE}
 if (any(class(SMD_S_LMA_KO) == "rma.mv")) {
  output_text1 <- "The effect on locomotor activity of administering a TAAR1 agonist in transgenic animals lacking the gene for the TAAR1 receptor  is shown in Figure 5.1. The pooled estimate for SMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate."
  output_text2 <- "Figure 5.1 - Forest plot of Locomotor activity for TAAR1 Agonists in TAAR1 receptor knockout animals"
} else {
  output_text1 <- "Multilevel analysis is only performed if there are 5 levels or more for at least one of Strain, Study and Experiment, and that is not the case here. We provide a conventional univariate random effects model to illustrate the data"
  output_text2 <- ""
}
```

`r output_text1`

**`r output_text2`**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=8, fig.width=10}
forest_metafor(SMD_S_LMA_KO, "TvC_KO","Locomotor activity")
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=8, fig.width=10}
 if (!any(class(SMD_S_LMA_KO) == "rma.mv")) {
   forest_metafor(SMD_LMA_KO, "TvC_KO","Locomotor activity") }
```

## 5.2 Outcome 2: Cognitive function

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, message = FALSE, fig.height=10}
if (any(df$SortLabel == "TvC_KO" & df$outcome_type == "Cognition")) {
  SMD_S_Cog_KO <- run_ML_SMD(df, "TvC_KO","Cognition",0.5 )
}
```

```{r message=FALSE, warning=FALSE, eval = TRUE, message + false, echo = FALSE, results='hide'}
if (any(df$SortLabel == "TvC_KO" & df$outcome_type == "Cognition")) {
  SMD_Cog_KO <- run_SMD(df, "TvC_KO", "Cognition")
}

```

```{r echo=FALSE}
 if (any(df$SortLabel == "TvC_KO" & df$outcome_type == "Cognition")) {
   if (any(class(SMD_S_Cog_KO) == "rma.mv")) {
  output_text1 <- "For combination studies, the effect of administering a TAAR1 agonist plus a conventional antipsychotic drug, compared with TAAR1 agonist alone, on cognitive function in animals using SMD as the effect size is shown in Figure 5.2. The pooled estimate for SMD across all individual comparisons is displayed as a diamond shape at the bottom of the plot. Dotted lines indicate the prediction interval of the pooled estimate."
  output_text2 <- "Figure 5.2 - Forest plot of cognitive function for TAAR1 Agonists in TAAR1 receptor knockout animals"
} else {
  output_text1 <- "Multilevel analysis is only performed if there are 5 levels or more for at least one of Strain, Study and Experiment, and that is not the case here. We provide a conventional univariate random effects model to illustrate the data"
  output_text2 <- ""
}
   } else {
  output_text1 <- "No studies reported cognitive outcomes in TAAR1 knockout animals"
  output_text2 <- ""
 }
```

`r output_text1`

**`r output_text2`**

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=10}
if (any(df$SortLabel == "TvC_KO" & df$outcome_type == "Cognition")) {
  forest_metafor(SMD_S_Cog_KO, "TvC_KO","Cognition")
}
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, fig.height=10}
    if (any(df$SortLabel == "TvC_KO" & df$outcome_type == "Cognition")) {
      if (!any(class(SMD_S_Cog_KO) == "rma.mv")) {
   forest_metafor(SMD_Cog_KO, "TvC_KO","Cognition") }}
```

```{r echo = FALSE}
   if (any(df$SortLabel == "TvC_KO" & df$outcome_type == "Cognition")) {
 if (any(class(SMD_S_Cog_KO) == "rma.mv")) {
  output_text3 <- paste0("For combination experiments, TAAR1 agonists with antipsychotic drugs, compared with antipsychotic drugs alone, had a pooled effect on cognition of SMD =", round(SMD_S_Cog_TAA[['beta']], 3), " (95% CI: ", round(SMD_S_Cog_TAA[['ci.lb']], 3), " to ", round(SMD_S_Cog_TAA[['ci.ub']], 3),", with a prediction interval of ", round(predict(SMD_S_Cog_TAA)$pi.lb, 3), " to ", round(predict(SMD_S_Cog_TAA)$pi.ub, 3), ").")
    output_text4 <- paste0(`r SMD_S_Cog_TAA$k`," experimental comparisons were reported in ",`r SMD_S_Cog_TAA$s.nlevels[3]`," experiments reported from ",`r SMD_S_Cog_TAA$s.nlevels[2]`," publications and involving ",`r SMD_S_Cog_TAA$s.nlevels[1]`," different animal strains. The between strain variance was ",`r SMD_S_Cog_TAA$sigma2[1]`,", the between study variance ",`r SMD_S_Cog_TAA$sigma2[2]`," and the within-experiment variance ",`r SMD_S_Cog_TAA$sigma2[3]`,".")
} else {
  output_text3 <- ""
  output_text4 <- ""
}
  output_text3 <- ""
  output_text4 <- ""
}

```

`r output_text3`

`r output_text4`

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE}

#### calculate non completion rate and side effects

c1 <- which(colnames(df) == "n allocated to group at experiment start?")
c2 <- which(colnames(df) == "n allocated to group at experiment start?_C")
c3 <- which(colnames(df) == "n allocated to group at experiment start?_I")
c4 <- which(colnames(df) == "F_S_n")
c5 <- which(colnames(df) == "F_C_n")
c6 <- which(colnames(df) == "F_T_n")

Nsdf <- df[,c(c2,c3,c5,c6)]
Nsdf <- subset(Nsdf, !Nsdf$`n allocated to group at experiment start?_C` == 999)
Nsdf <- subset(Nsdf, !Nsdf$`n allocated to group at experiment start?_C` == 9999)
Nsdf$closs <- Nsdf$`n allocated to group at experiment start?_C` - Nsdf$F_C_n
Nsdf$tloss <- Nsdf$`n allocated to group at experiment start?_I` - Nsdf$F_T_n

Nsdf$cprop <- Nsdf$closs/Nsdf$`n allocated to group at experiment start?_C`
Nsdf$tprop <- Nsdf$closs/Nsdf$`n allocated to group at experiment start?_I`


ctot <- sum(Nsdf$`n allocated to group at experiment start?_C`)
ttot <- sum(Nsdf$`n allocated to group at experiment start?_I`)
cltot <- sum(Nsdf$closs)
tltot <- sum(Nsdf$tloss)
closs <- cltot/ctot
tloss <- tltot/ttot

dfi1 <- subset(df, !is.na(df$`Treatment dosing regime[1]_I`))
dfi2 <- subset(df, !is.na(df$`Treatment dosing regime[2]_I`))
dfi1a <- as.data.frame(dfi1$`Treatment dosing regime[1]_I`)
dfi2a <- as.data.frame(dfi2$`Treatment dosing regime[2]_I`)
colnames(dfi1a) <- colnames(dfi2a) <- "Regime"
dfi <- rbind(dfi1a, dfi2a)
dfis <- subset(dfi, dfi$Regime == "Single dose")
dfisn <- nrow(dfis)
dfin <- nrow(dfi)
dfiper <- (dfisn/dfin)*100

```

# 6. Proportion of animals not progressing to outcome measurement, potentially reflecting adverse effects of treatment

`r closs*100`% of `r ctot` animals in Control cohorts and `r tloss*100`% of `r ttot` animals in Intervention cohorts 'dropped out' between allocation to group and outcome measurement. Given that `r dfisn` of `r dfin` interventions (`r dfiper`%) were administered as a single dose, treatment emergent adverse effects likely to lead to withdrawal of an animal from the study would be unusual, and technical failure or attrition is more likely. This analysis is based on full reporting of animals excluded from analyses, and it may be that group sizes were specified 'after the event', or that there was unreported replacement of animals excluded during the experiment, so these data should be interpreted with considerable caution.

# 7. Summary of the evidence

## 7.1 TAAR1 agonists versus control

```{r echo = FALSE}
SoE_TvC <- read_xlsx("data/soe_tables_20240205.xlsx", "TvC")

knitr::kable(SoE_TvC) %>%
  kable_styling(bootstrap_options = "bordered")

```

## 7.2 TAAR1 agonists versus conventional antipsychotic drugs

```{r echo = FALSE}
SoE_TvA <- read_xlsx("data/soe_tables_20240205.xlsx", "TvA")

knitr::kable(SoE_TvA) %>%
  kable_styling(bootstrap_options = "bordered")

```

Rationale for conclusions for indirectness: **[1] TAARI 1 agonists v control, outcome 'Locomotor activity': Moderate risk of indirectness** We had concerns for indirectness because all experiments were in rodents; no models manipulated early environmental factors; and no models assessed outcomes identified by the JLA schizophrenia Priority Setting Partnership 'Top 10'. Further, in rat brain slices, TAAR1 antagonists inhibit met-amphetamine induced- but not basal- dopamine release ([[10.3390/ijms23158543]{.underline}](https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdoi.org%2F10.3390%252Fijms23158543&data=05%7C02%7Cvirginia.chiocchia%40unibe.ch%7C25583204c1ea416b735a08dc272a2a2f%7Cd400387a212f43eaac7f77aa12d7977e%7C1%7C0%7C638428309296363946%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=lJf95AImKBniG9x%2FighvKrckm8k5lRJOAiPkrHC2C58%3D&reserved=0 "https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdoi.org%2F10.3390%252Fijms23158543&data=05%7C02%7Cvirginia.chiocchia%40unibe.ch%7C25583204c1ea416b735a08dc272a2a2f%7Cd400387a212f43eaac7f77aa12d7977e%7C1%7C0%7C638428309296363946%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=lJf95AImKBniG9x%2FighvKrckm8k5lRJOAiPkrHC2C58%3D&reserved=0")); and SEP-363856 (Ulotaront) inhibits ketamine-induced striatal dopamine synthesis in the mouse ([[10.1038/s41380-020-0740-6]{.underline}](https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdoi.org%2F10.1038%252Fs41380-020-0740-6&data=05%7C02%7Cvirginia.chiocchia%40unibe.ch%7C25583204c1ea416b735a08dc272a2a2f%7Cd400387a212f43eaac7f77aa12d7977e%7C1%7C0%7C638428309296369817%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=xGQnYNZfwYv5baeI0NVj%2BwMm0iaE76cRlDMUFuAQU2A%3D&reserved=0 "https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdoi.org%2F10.1038%252Fs41380-020-0740-6&data=05%7C02%7Cvirginia.chiocchia%40unibe.ch%7C25583204c1ea416b735a08dc272a2a2f%7Cd400387a212f43eaac7f77aa12d7977e%7C1%7C0%7C638428309296369817%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C0%7C%7C%7C&sdata=xGQnYNZfwYv5baeI0NVj%2BwMm0iaE76cRlDMUFuAQU2A%3D&reserved=0")), suggesting that some of the effects of TAAR1 agonism may be due to interference with model induction rather than reversal of the induced phenotype.

However, for models using DAT knock out, the homologous human gene is associated with schizophrenia in some populations, indirect DAT inhibitors can cause psychosis in humans, and the effect of indirect DAT inhibitors is reported to be mediated through TAAR1 agonism. For the pharmacological models used to induce locomotor activity the same agents used in animal models induce psychosis and exacerbate symptoms in humans and induce EEG changes in humans and animals which are responsive to treatment in animals. Psychostimulant models induce mesolimbic dopamine dysregulation seen in humans, and the PCP model is associated with reduced brain volume, also seen in human disease.

**[2] TAARI 1 agonists v control, outcome 'Cognitive outcomes': Moderate risk of indirectness** We had concerns for indirectness because all experiments were in rodents; no models manipulated early environmental factors; and no models assessed outcomes identified by the JLA schizophrenia Priority Setting Partnership 'Top 10'. However, for models using DAT knock out, the homologous human gene is associated with schizophrenia in some populations, indirect DAT inhibitors can cause psychosis in humans, and the effect of indirect DAT inhibitors is reported to be mediated through TAAR1 agonism. For the pharmacological models used to induce locomotor activity the same agents used in animal models induce psychosis and exacerbate symptoms in humans and induce EEG changes in humans and animals which are responsive to treatment in animals. Psychostimulant models induce mesolimbic dopamine dysregulation seen in humans, and the PCP model is associated with reduced brain volume, also seen in human disease.

**[3] TAARI 1 agonists v conventional antipsychotic drugs, outcome 'Locomotor activity': Moderate risk of indirectness** We had concerns for indirectness because all experiments were in rodents; no models manipulated early environmental factors; and no models assessed outcomes identified by the JLA schizophrenia Priority Setting Partnership 'Top 10'. For the pharmacological models used to induce locomotor activity the same agents used in animal models induce psychosis and exacerbate symptoms in humans and induce EEG changes in humans and animals which are responsive to treatment in animals. Psychostimulant models induce mesolimbic dopamine dysregulation seen in humans, and the PCP model is associated with reduced brain volume, also seen in human disease.

**[4] TAARI 1 agonists v conventional antipsychotic drugs, outcome 'Cognitive outcomes': Moderate risk of indirectness** Only one publication contributes to this outcome, using the MK801- induced cognitive dysfunction model in the ICR mouse.

## Evaluation of indirectness of evidence (based on criteria in document "Assessing the certainty of evidence in animal studies") for the studies included in the review

The framework for the evaluation of indirectness is based on eight dimensions, based on the work of Belzung and Lemoine, and comprising **(i) Homological validity** - what is the extent of homology between the model organism and humans relevant to the condition studied? **(ii) Ontopathogenic validity** - Does the model include prenatal or early life exposures inducing transition from initial organism to vulnerable organism? **(iii) Triggering validity** - are any triggering factors used in the modelling -- or their homologues - known to induce psychosis or relapse in humans? **(iv) Mechanistic validity** - whether the neurobiological or cognitive mechanisms which operate in human disease can be observed in the animal model; **(v) Induction validity** - Does the induction of the disease model induce changes in biomarkers (see below) which are known to be altered in human disease? **(vi) Remission validity** - What is the effect of other drugs known to be effective in humans in the particular animal model / outcome measure pair? **(vii) Biomarker validity** - are changes in disease markers (e.g. neurotransmitter levels, structural brain imaging) seen in human disease also seen in this animal model? **(viii) Ethological validity** - what is the 'behavioural distance' between the model phenotype in animals and the symptoms and signs of human disease at which treatment is targeted?

```{r echo = FALSE}
SoE_Indir <- read_xlsx("data/soe_tables_20240205.xlsx", "Indir") ### ? where is this##

knitr::kable(SoE_Indir) %>%
  kable_styling(bootstrap_options = "bordered")

```

The description of the criteria is available at <https://doi.org/10.17605/OSF.IO/TDMAU>

# 8. Software used

```{r echo=FALSE}
grateful::cite_packages(output = "paragraph", pkgs = "Session", out.dir = ".")
```
